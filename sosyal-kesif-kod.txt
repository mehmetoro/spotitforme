// lib/gamification/game-engine.ts
export class GamificationEngine {
  // ROZET SÄ°STEMÄ°
  static BADGES = {
    FIRST_SIGHTING: { id: 'first-sighting', name: 'Ä°lk Ä°z', icon: 'ğŸ‘ï¸', points: 10 },
    HELPER_LEVEL_1: { id: 'helper-1', name: 'YardÄ±msever', icon: 'ğŸ¤', points: 50 },
    RARE_FINDER: { id: 'rare-finder', name: 'Nadir AvcÄ±sÄ±', icon: 'ğŸ”', points: 100 },
    QUICK_RESPONSE: { id: 'quick-response', name: 'HÄ±zlÄ± Tepki', icon: 'âš¡', points: 25 },
    SOCIAL_INFLUENCER: { id: 'social-influencer', name: 'Topluluk Lideri', icon: 'ğŸ‘‘', points: 500 }
  }

  // SEVÄ°YE SÄ°STEMÄ°
  static LEVELS = [
    { level: 1, name: 'Yeni GÃ¶zcÃ¼', minPoints: 0, color: 'gray' },
    { level: 2, name: 'Aktif AvcÄ±', minPoints: 100, color: 'blue' },
    { level: 3, name: 'Uzman Bulucu', minPoints: 500, color: 'green' },
    { level: 4, name: 'Master Dedektif', minPoints: 2000, color: 'purple' },
    { level: 5, name: 'Efsane AvcÄ±', minPoints: 5000, color: 'gold' }
  ]

  // PUAN SÄ°STEMÄ°
  static POINT_RULES = {
    SIGHTING_WITHOUT_PHOTO: 5,
    SIGHTING_WITH_PHOTO: 15,
    SIGHTING_WITH_PRICE: 10,
    RARE_ITEM_REPORT: 25,
    PURCHASE_FACILITATED: 50,
    DAILY_LOGIN_STREAK: [5, 10, 15, 20, 25], // 5 gÃ¼n Ã¼st Ã¼ste
    SOCIAL_SHARE: 10,
    PROFILE_COMPLETION: 30
  }
}



// components/UserProfileCard.tsx
'use client'

import { useEffect, useState } from 'react'
import { supabase } from '@/lib/supabase'
import { GamificationEngine } from '@/lib/gamification/game-engine'

interface UserProfileCardProps {
  userId: string
  compact?: boolean
}

export default function UserProfileCard({ userId, compact = false }: UserProfileCardProps) {
  const [profile, setProfile] = useState<any>(null)
  const [reputation, setReputation] = useState<any>(null)
  const [loading, setLoading] = useState(true)

  useEffect(() => {
    fetchUserData()
  }, [userId])

  const fetchUserData = async () => {
    try {
      const [{ data: profileData }, { data: repData }] = await Promise.all([
        supabase.from('user_profiles').select('*').eq('id', userId).single(),
        supabase.from('user_reputation').select('*').eq('user_id', userId).single()
      ])

      setProfile(profileData)
      setReputation(repData)
    } catch (error) {
      console.error('Profil yÃ¼klenemedi:', error)
    } finally {
      setLoading(false)
    }
  }

  if (loading) {
    return <div className="animate-pulse bg-gray-200 rounded-lg h-32"></div>
  }

  const userLevel = GamificationEngine.LEVELS.find(l => l.level === reputation?.current_level) || GamificationEngine.LEVELS[0]
  const nextLevel = GamificationEngine.LEVELS.find(l => l.level === (reputation?.current_level || 0) + 1)

  return (
    <div className={`bg-white rounded-xl shadow-lg ${compact ? 'p-4' : 'p-6'}`}>
      {/* Ãœst KÄ±sÄ±m - Avatar ve Temel Bilgiler */}
      <div className="flex items-start space-x-4">
        <div className="relative">
          <div className={`w-${compact ? '12' : '16'} h-${compact ? '12' : '16'} rounded-full border-4`} 
               style={{ borderColor: userLevel.color }}>
            {profile?.avatar_url ? (
              <img src={profile.avatar_url} alt={profile.name} className="w-full h-full rounded-full" />
            ) : (
              <div className={`w-full h-full rounded-full bg-gradient-to-br from-${userLevel.color}-400 to-${userLevel.color}-600 flex items-center justify-center text-white font-bold text-${compact ? 'lg' : 'xl'}`}>
                {profile?.name?.[0] || 'K'}
              </div>
            )}
          </div>
          
          {/* Seviye GÃ¶stergesi */}
          {!compact && (
            <div className="absolute -bottom-2 -right-2 bg-white rounded-full p-1 shadow-lg">
              <div className={`w-8 h-8 rounded-full bg-gradient-to-br from-${userLevel.color}-400 to-${userLevel.color}-600 flex items-center justify-center text-white text-xs font-bold`}>
                {userLevel.level}
              </div>
            </div>
          )}
        </div>

        <div className="flex-1">
          <div className="flex items-center justify-between">
            <div>
              <h3 className={`font-bold ${compact ? 'text-lg' : 'text-xl'}`}>
                {profile?.name || 'KullanÄ±cÄ±'}
              </h3>
              <p className={`text-${userLevel.color}-600 font-medium ${compact ? 'text-sm' : ''}`}>
                {userLevel.name}
              </p>
            </div>
            
            {!compact && (
              <div className="text-right">
                <div className="text-2xl font-bold text-gray-900">
                  {reputation?.total_points || 0}
                </div>
                <div className="text-sm text-gray-500">Toplam Puan</div>
              </div>
            )}
          </div>

          {/* Progress Bar */}
          {!compact && nextLevel && (
            <div className="mt-4">
              <div className="flex justify-between text-sm mb-1">
                <span className="text-gray-600">Seviye {userLevel.level}</span>
                <span className="font-medium">
                  {reputation?.total_points || 0} / {nextLevel.minPoints} puan
                </span>
              </div>
              <div className="w-full bg-gray-200 rounded-full h-2">
                <div 
                  className="h-2 rounded-full bg-gradient-to-r from-blue-500 to-purple-600"
                  style={{ 
                    width: `${Math.min(100, ((reputation?.total_points || 0) / nextLevel.minPoints) * 100)}%` 
                  }}
                ></div>
              </div>
              <p className="text-xs text-gray-500 mt-1">
                {nextLevel.minPoints - (reputation?.total_points || 0)} puan kaldÄ±: <strong>{nextLevel.name}</strong>
              </p>
            </div>
          )}
        </div>
      </div>

      {/* Rozetler */}
      {!compact && reputation?.badges && reputation.badges.length > 0 && (
        <div className="mt-6">
          <h4 className="font-medium text-gray-700 mb-3">KazanÄ±lan Rozetler</h4>
          <div className="flex flex-wrap gap-2">
            {reputation.badges.slice(0, 6).map((badgeId: string) => {
              const badge = Object.values(GamificationEngine.BADGES).find(b => b.id === badgeId)
              return badge ? (
                <div key={badge.id} className="tooltip" data-tip={badge.name}>
                  <div className="w-10 h-10 rounded-full bg-gradient-to-br from-yellow-100 to-yellow-300 flex items-center justify-center text-lg">
                    {badge.icon}
                  </div>
                </div>
              ) : null
            })}
            {reputation.badges.length > 6 && (
              <div className="w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center text-gray-600 font-medium">
                +{reputation.badges.length - 6}
              </div>
            )}
          </div>
        </div>
      )}

      {/* Ä°statistikler (Compact modda gizle) */}
      {!compact && (
        <div className="mt-6 grid grid-cols-2 md:grid-cols-4 gap-4">
          <div className="text-center">
            <div className="text-2xl font-bold text-blue-600">{reputation?.total_sightings || 0}</div>
            <div className="text-sm text-gray-600">YardÄ±m</div>
          </div>
          <div className="text-center">
            <div className="text-2xl font-bold text-green-600">{reputation?.total_photos || 0}</div>
            <div className="text-sm text-gray-600">FotoÄŸraf</div>
          </div>
          <div className="text-center">
            <div className="text-2xl font-bold text-purple-600">{reputation?.total_rare_finds || 0}</div>
            <div className="text-sm text-gray-600">Nadir BuluÅŸ</div>
          </div>
          <div className="text-center">
            <div className="text-2xl font-bold text-orange-600">{reputation?.daily_streak || 0}</div>
            <div className="text-sm text-gray-600">GÃ¼n Streak</div>
          </div>
        </div>
      )}
    </div>
  )
}



// components/QuickSightingButton.tsx
'use client'

import { useState } from 'react'
import QuickSightingModal from './QuickSightingModal'

export default function QuickSightingButton() {
  const [showModal, setShowModal] = useState(false)

  return (
    <>
      {/* Floating Button */}
      <button
        onClick={() => setShowModal(true)}
        className="fixed bottom-6 right-6 z-50 bg-gradient-to-r from-green-500 to-emerald-600 text-white p-4 rounded-full shadow-2xl hover:shadow-3xl transition-all duration-300 hover:scale-110 group"
      >
        <div className="flex items-center space-x-2">
          <span className="text-2xl">ğŸ‘ï¸</span>
          <span className="font-bold hidden md:inline-block group-hover:inline-block transition-all">
            Nadir GÃ¶rdÃ¼m!
          </span>
        </div>
        
        {/* Puan gÃ¶sterimi */}
        <div className="absolute -top-2 -right-2 bg-yellow-500 text-white text-xs font-bold px-2 py-1 rounded-full">
          +5-25
        </div>
      </button>

      {/* Modal */}
      <QuickSightingModal
        isOpen={showModal}
        onClose={() => setShowModal(false)}
        onSuccess={() => {
          // Bildirim baÅŸarÄ±lÄ± olduÄŸunda sayfayÄ± yenile
          window.location.reload()
        }}
      />
    </>
  )
}




// components/Leaderboard.tsx
'use client'

import { useEffect, useState } from 'react'
import { supabase } from '@/lib/supabase'
import { GamificationEngine } from '@/lib/gamification/game-engine'

export default function Leaderboard() {
  const [leaderboard, setLeaderboard] = useState<any[]>([])
  const [loading, setLoading] = useState(true)
  const [timeRange, setTimeRange] = useState<'daily' | 'weekly' | 'all'>('weekly')

  useEffect(() => {
    fetchLeaderboard()
  }, [timeRange])

  const fetchLeaderboard = async () => {
    setLoading(true)
    try {
      let query = supabase
        .from('leaderboard_view')
        .select('*')
        .limit(20)

      if (timeRange === 'daily') {
        query = query.order('total_points', { ascending: false })
      } else if (timeRange === 'weekly') {
        // Bu haftanÄ±n puanlarÄ± iÃ§in farklÄ± bir view gerekebilir
        query = query.order('total_points', { ascending: false })
      }

      const { data, error } = await query

      if (error) throw error
      setLeaderboard(data || [])
    } catch (error) {
      console.error('Leaderboard yÃ¼klenemedi:', error)
    } finally {
      setLoading(false)
    }
  }

  const getRankIcon = (rank: number) => {
    switch(rank) {
      case 1: return 'ğŸ¥‡'
      case 2: return 'ğŸ¥ˆ'
      case 3: return 'ğŸ¥‰'
      default: return `#${rank}`
    }
  }

  return (
    <div className="bg-white rounded-xl shadow-lg p-6">
      <div className="flex items-center justify-between mb-6">
        <div>
          <h2 className="text-xl font-bold text-gray-900">ğŸ† Lider Tablosu</h2>
          <p className="text-gray-600">En aktif bulucular</p>
        </div>
        
        <div className="flex space-x-2">
          {['daily', 'weekly', 'all'].map((range) => (
            <button
              key={range}
              onClick={() => setTimeRange(range as any)}
              className={`px-4 py-2 rounded-lg text-sm font-medium ${
                timeRange === range
                  ? 'bg-blue-600 text-white'
                  : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
              }`}
            >
              {range === 'daily' ? 'GÃ¼nlÃ¼k' : range === 'weekly' ? 'HaftalÄ±k' : 'TÃ¼m Zamanlar'}
            </button>
          ))}
        </div>
      </div>

      {loading ? (
        <div className="space-y-4">
          {[...Array(5)].map((_, i) => (
            <div key={i} className="animate-pulse flex items-center space-x-4">
              <div className="w-10 h-10 bg-gray-200 rounded-full"></div>
              <div className="flex-1">
                <div className="h-4 bg-gray-200 rounded w-1/4"></div>
                <div className="h-3 bg-gray-200 rounded w-1/2 mt-2"></div>
              </div>
            </div>
          ))}
        </div>
      ) : (
        <div className="space-y-3">
          {leaderboard.map((user, index) => {
            const userLevel = GamificationEngine.LEVELS.find(l => l.level === user.current_level)
            
            return (
              <div 
                key={user.user_id}
                className={`flex items-center space-x-4 p-3 rounded-lg ${
                  index < 3 ? 'bg-gradient-to-r from-yellow-50 to-yellow-100 border border-yellow-200' : 'hover:bg-gray-50'
                }`}
              >
                {/* SÄ±ra */}
                <div className="flex-shrink-0">
                  <div className={`w-10 h-10 rounded-full flex items-center justify-center font-bold ${
                    index === 0 ? 'bg-yellow-500 text-white' :
                    index === 1 ? 'bg-gray-400 text-white' :
                    index === 2 ? 'bg-amber-700 text-white' :
                    'bg-gray-200 text-gray-700'
                  }`}>
                    {getRankIcon(index + 1)}
                  </div>
                </div>

                {/* Avatar ve Ä°sim */}
                <div className="flex-1 flex items-center space-x-3">
                  <div className="w-12 h-12 rounded-full overflow-hidden bg-gray-200">
                    {user.avatar_url ? (
                      <img src={user.avatar_url} alt={user.name} className="w-full h-full object-cover" />
                    ) : (
                      <div className="w-full h-full bg-gradient-to-br from-blue-400 to-purple-500 flex items-center justify-center text-white font-bold">
                        {user.name?.[0] || 'K'}
                      </div>
                    )}
                  </div>
                  
                  <div className="flex-1">
                    <div className="flex items-center justify-between">
                      <div>
                        <h4 className="font-bold text-gray-900">{user.name}</h4>
                        <p className="text-sm" style={{ color: userLevel?.color }}>
                          {userLevel?.name}
                        </p>
                      </div>
                      <div className="text-right">
                        <div className="font-bold text-gray-900">{user.total_points} puan</div>
                        <div className="text-xs text-gray-500">
                          {user.total_sightings} yardÄ±m
                        </div>
                      </div>
                    </div>
                    
                    {/* Progress bar (mini) */}
                    <div className="mt-2">
                      <div className="w-full bg-gray-200 rounded-full h-1">
                        <div 
                          className="h-1 rounded-full bg-gradient-to-r from-blue-500 to-purple-600"
                          style={{ width: `${Math.min(100, (user.total_points / 5000) * 100)}%` }}
                        ></div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            )
          })}
        </div>
      )}

      {/* Kendi Pozisyonun (alt kÄ±sÄ±m) */}
      <div className="mt-6 pt-6 border-t">
        <button 
          onClick={() => fetchLeaderboard()}
          className="w-full text-center text-blue-600 hover:text-blue-800 font-medium py-2"
        >
          Tam Listeyi GÃ¶r
        </button>
      </div>
    </div>
  )
}



// components/DailyChallenges.tsx
'use client'

import { useEffect, useState } from 'react'
import { supabase } from '@/lib/supabase'

export default function DailyChallenges() {
  const [challenges, setChallenges] = useState<any[]>([])
  const [userProgress, setUserProgress] = useState<Record<string, number>>({})
  const [loading, setLoading] = useState(true)

  useEffect(() => {
    fetchChallenges()
  }, [])

  const fetchChallenges = async () => {
    try {
      const [{ data: challengesData }, { data: user }] = await Promise.all([
        supabase
          .from('daily_challenges')
          .select('*')
          .eq('is_active', true)
          .order('reward_points', { ascending: false }),
        supabase.auth.getUser()
      ])

      if (user.user) {
        const { data: progressData } = await supabase
          .from('user_challenge_progress')
          .select('*')
          .eq('user_id', user.user.id)

        const progressMap: Record<string, number> = {}
        progressData?.forEach(p => {
          progressMap[p.challenge_id] = p.progress_count
        })

        setUserProgress(progressMap)
      }

      setChallenges(challengesData || [])
    } catch (error) {
      console.error('Challenges yÃ¼klenemedi:', error)
    } finally {
      setLoading(false)
    }
  }

  const getChallengeIcon = (type: string) => {
    switch(type) {
      case 'sighting': return 'ğŸ‘ï¸'
      case 'social': return 'ğŸ‘¥'
      case 'completion': return 'âœ…'
      case 'streak': return 'ğŸ”¥'
      default: return 'ğŸ¯'
    }
  }

  return (
    <div className="bg-gradient-to-br from-blue-50 to-purple-50 rounded-xl shadow-lg p-6 border border-blue-100">
      <div className="flex items-center justify-between mb-6">
        <div>
          <h2 className="text-xl font-bold text-gray-900">ğŸ¯ GÃ¼nlÃ¼k Hedefler</h2>
          <p className="text-gray-600">Tamamla, puan kazan!</p>
        </div>
        <div className="text-3xl">ğŸ†</div>
      </div>

      {loading ? (
        <div className="space-y-4">
          {[...Array(3)].map((_, i) => (
            <div key={i} className="animate-pulse bg-white bg-opacity-50 rounded-lg p-4">
              <div className="h-4 bg-gray-200 rounded w-3/4"></div>
              <div className="h-3 bg-gray-200 rounded w-1/2 mt-2"></div>
            </div>
          ))}
        </div>
      ) : (
        <div className="space-y-4">
          {challenges.map((challenge) => {
            const progress = userProgress[challenge.id] || 0
            const percentage = Math.min(100, (progress / challenge.target_count) * 100)
            const isCompleted = progress >= challenge.target_count

            return (
              <div 
                key={challenge.id}
                className={`bg-white rounded-lg p-4 border-2 ${
                  isCompleted ? 'border-green-500 bg-green-50' : 'border-gray-200'
                }`}
              >
                <div className="flex items-start justify-between">
                  <div className="flex items-start space-x-3">
                    <div className="text-2xl">
                      {getChallengeIcon(challenge.challenge_type)}
                    </div>
                    <div>
                      <h4 className="font-bold text-gray-900">{challenge.title}</h4>
                      <p className="text-sm text-gray-600">{challenge.description}</p>
                      
                      {/* Progress */}
                      <div className="mt-2">
                        <div className="flex justify-between text-sm mb-1">
                          <span className="text-gray-600">
                            {progress} / {challenge.target_count}
                          </span>
                          <span className="font-medium text-green-600">
                            +{challenge.reward_points} puan
                          </span>
                        </div>
                        <div className="w-full bg-gray-200 rounded-full h-2">
                          <div 
                            className={`h-2 rounded-full ${
                              isCompleted 
                                ? 'bg-green-500' 
                                : 'bg-gradient-to-r from-blue-500 to-purple-500'
                            }`}
                            style={{ width: `${percentage}%` }}
                          ></div>
                        </div>
                      </div>
                    </div>
                  </div>

                  {/* Durum */}
                  <div className="text-right">
                    {isCompleted ? (
                      <span className="px-3 py-1 bg-green-100 text-green-800 rounded-full text-sm font-medium">
                        âœ… TamamlandÄ±
                      </span>
                    ) : (
                      <button className="px-3 py-1 bg-blue-100 text-blue-800 hover:bg-blue-200 rounded-full text-sm font-medium">
                        BaÅŸla
                      </button>
                    )}
                  </div>
                </div>
              </div>
            )
          })}
        </div>
      )}

      {/* TÃ¼m hedefler tamamlandÄ±ysa */}
      {challenges.length > 0 && 
       challenges.every(c => (userProgress[c.id] || 0) >= c.target_count) && (
        <div className="mt-6 p-4 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg text-center">
          <div className="text-3xl mb-2">ğŸ‰</div>
          <h3 className="font-bold text-lg">TÃ¼m Hedefler TamamlandÄ±!</h3>
          <p className="text-green-100">
            HarikasÄ±n! YarÄ±n yeni hedeflerle devam et.
          </p>
        </div>
      )}
    </div>
  )
}




// lib/analytics/events.ts
export const GAMIFICATION_EVENTS = {
  POINTS_EARNED: 'points_earned',
  BADGE_EARNED: 'badge_earned',
  LEVEL_UP: 'level_up',
  DAILY_STREAK: 'daily_streak',
  CHALLENGE_COMPLETED: 'challenge_completed',
  LEADERBOARD_VIEW: 'leaderboard_view'
}


components/QuickSightingModal.tsx

'use client'

import { useState, useRef } from 'react'
import { useRouter } from 'next/navigation'
import { supabase } from '@/lib/supabase'
import Image from 'next/image'
import LocationSelector from './LocationSelector'

interface QuickSightingModalProps {
  isOpen: boolean
  onClose: () => void
  onSuccess?: () => void
}

export default function QuickSightingModal({ 
  isOpen, 
  onClose, 
  onSuccess 
}: QuickSightingModalProps) {
  const router = useRouter()
  const fileInputRef = useRef<HTMLInputElement>(null)
  
  const [loading, setLoading] = useState(false)
  const [locationData, setLocationData] = useState<any>(null)
  const [photoFile, setPhotoFile] = useState<File | null>(null)
  const [photoPreview, setPhotoPreview] = useState<string | null>(null)
  
  const [formData, setFormData] = useState({
    description: '',
    category: '',
    hasPhoto: false
  })

  const handleLocationSelect = (location: any) => {
    setLocationData(location)
  }

  const handlePhotoToggle = (checked: boolean) => {
    setFormData({...formData, hasPhoto: checked})
    if (!checked) {
      setPhotoFile(null)
      setPhotoPreview(null)
    } else {
      fileInputRef.current?.click()
    }
  }

  const handlePhotoUpload = (e: React.ChangeEvent<HTMLInputElement>) => {
    const file = e.target.files?.[0]
    if (file) {
      // Max 5MB kontrolÃ¼
      if (file.size > 5 * 1024 * 1024) {
        alert('Resim boyutu 5MB\'dan kÃ¼Ã§Ã¼k olmalÄ±dÄ±r')
        return
      }
      
      setPhotoFile(file)
      const reader = new FileReader()
      reader.onloadend = () => {
        setPhotoPreview(reader.result as string)
      }
      reader.readAsDataURL(file)
    }
  }

  const calculatePoints = () => {
    let points = 5 // Temel puan
    
    if (formData.hasPhoto) points += 10
    if (locationData) points += 5
    if (formData.category) points += 3
    
    return points
  }

  const handleSubmit = async () => {
    if (!locationData) {
      alert('LÃ¼tfen konum seÃ§in')
      return
    }

    if (!formData.description.trim()) {
      alert('LÃ¼tfen ne gÃ¶rdÃ¼ÄŸÃ¼nÃ¼zÃ¼ yazÄ±n')
      return
    }

    setLoading(true)

    try {
      const { data: { user } } = await supabase.auth.getUser()
      if (!user) {
        router.push('/login?redirect=/')
        return
      }

      let photoUrl = null
      
      // 1. FotoÄŸraf yÃ¼kle
      if (photoFile) {
        const fileExt = photoFile.name.split('.').pop()
        const fileName = `${user.id}/sightings/${Date.now()}.${fileExt}`
        
        const { error: uploadError } = await supabase.storage
          .from('spot-images')
          .upload(fileName, photoFile)
        
        if (uploadError) throw uploadError
        
        const { data: { publicUrl } } = supabase.storage
          .from('spot-images')
          .getPublicUrl(fileName)
        
        photoUrl = publicUrl
      }

      // 2. Quick sighting oluÅŸtur
      const { data: sighting, error: sightingError } = await supabase
        .from('quick_sightings')
        .insert({
          user_id: user.id,
          description: formData.description,
          category: formData.category,
          has_photo: formData.hasPhoto,
          photo_url: photoUrl,
          location_name: locationData.name,
          address: locationData.address,
          latitude: locationData.latitude,
          longitude: locationData.longitude,
          city: locationData.city,
          district: locationData.district,
          points_earned: calculatePoints(),
          status: 'active'
        })
        .select()
        .single()

      if (sightingError) throw sightingError

      // 3. Puan ekle (gamification)
      await supabase.rpc('add_user_points', {
        user_id: user.id,
        points_to_add: calculatePoints(),
        activity_type: 'quick_sighting'
      })

      // 4. Badge kontrolÃ¼ (ilk sighting)
      const { data: reputation } = await supabase
        .from('user_reputation')
        .select('total_sightings')
        .eq('user_id', user.id)
        .single()

      if (reputation?.total_sightings === 1) {
        await supabase.rpc('award_badge', {
          user_id: user.id,
          badge_id: 'first_sighting'
        })
      }

      // 5. Ana sayfada gÃ¶sterilmek Ã¼zere global state'e ekle
      // (Real-time iÃ§in Supabase Realtime kullanÄ±labilir)
      
      // 6. Social feed'e ekle (opsiyonel)
      if (process.env.NEXT_PUBLIC_ENABLE_SOCIAL === 'true') {
        await supabase.from('social_posts').insert({
          user_id: user.id,
          type: 'sighting',
          caption: `"${formData.description}" gÃ¶rdÃ¼m!`,
          location: locationData.name,
          image_urls: photoUrl ? [photoUrl] : [],
          hashtags: ['#nadirgÃ¶rdÃ¼m', '#spotitforme']
        })
      }

      // BaÅŸarÄ± mesajÄ±
      alert(`ğŸ‰ Bildiriminiz kaydedildi! ${calculatePoints()} puan kazandÄ±nÄ±z.`)
      
      // Formu sÄ±fÄ±rla
      setFormData({ description: '', category: '', hasPhoto: false })
      setLocationData(null)
      setPhotoFile(null)
      setPhotoPreview(null)
      
      onClose()
      if (onSuccess) onSuccess()
      
      // SayfayÄ± yenile
      router.refresh()

    } catch (error: any) {
      console.error('Bildirim hatasÄ±:', error)
      alert(`Hata: ${error.message}`)
    } finally {
      setLoading(false)
    }
  }

  if (!isOpen) return null

  return (
    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
      <div className="bg-white rounded-2xl shadow-2xl w-full max-w-md max-h-[90vh] overflow-y-auto">
        {/* Header */}
        <div className="sticky top-0 bg-white border-b p-6 z-10">
          <div className="flex items-center justify-between">
            <div>
              <h2 className="text-2xl font-bold text-gray-900">ğŸ‘ï¸ Nadir GÃ¶rdÃ¼m!</h2>
              <p className="text-gray-600">HÄ±zlÄ±ca bildirim gÃ¶nder, puan kazan</p>
            </div>
            <button
              onClick={onClose}
              className="text-gray-500 hover:text-gray-700 text-2xl"
            >
              Ã—
            </button>
          </div>
        </div>

        {/* Form */}
        <div className="p-6 space-y-6">
          {/* AÃ§Ä±klama */}
          <div>
            <label className="block text-sm font-medium text-gray-700 mb-2">
              Ne gÃ¶rdÃ¼nÃ¼z? *
            </label>
            <textarea
              value={formData.description}
              onChange={(e) => setFormData({...formData, description: e.target.value})}
              placeholder="Ã–rn: Vintage Nikon F2 kamera, eski Rolex saat, antika Hereke halÄ±sÄ±..."
              className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
              rows={3}
              required
            />
          </div>

          {/* KONUM SEÃ‡Ä°CÄ° */}
          <LocationSelector 
            onLocationSelect={handleLocationSelect}
            initialLocation=""
          />

          {/* Kategori */}
          <div>
            <label className="block text-sm font-medium text-gray-700 mb-2">
              Kategori
            </label>
            <select
              value={formData.category}
              onChange={(e) => setFormData({...formData, category: e.target.value})}
              className="w-full px-4 py-3 border border-gray-300 rounded-lg"
            >
              <option value="">Kategori seÃ§in (opsiyonel)</option>
              <option value="electronics">Elektronik</option>
              <option value="fashion">Giyim & Aksesuar</option>
              <option value="home">Ev & BahÃ§e</option>
              <option value="collectible">Koleksiyon</option>
              <option value="vehicle">AraÃ§ & ParÃ§a</option>
              <option value="other">DiÄŸer</option>
            </select>
          </div>

          {/* FOTOÄRAF BÃ–LÃœMÃœ */}
          <div className="space-y-3">
            <div className="flex items-center space-x-3">
              <input
                type="checkbox"
                checked={formData.hasPhoto}
                onChange={(e) => handlePhotoToggle(e.target.checked)}
                className="w-4 h-4 text-green-600"
                id="hasPhoto"
              />
              <label htmlFor="hasPhoto" className="text-sm font-medium text-gray-700">
                ğŸ“¸ FotoÄŸrafÄ±m var (+10 ekstra puan!)
              </label>
            </div>

            {formData.hasPhoto && (
              <div className="mt-3">
                {photoPreview ? (
                  <div className="relative">
                    <img
                      src={photoPreview}
                      alt="Preview"
                      className="w-full h-48 object-cover rounded-lg border-2 border-green-200"
                    />
                    <button
                      type="button"
                      onClick={() => {
                        setPhotoFile(null)
                        setPhotoPreview(null)
                      }}
                      className="absolute top-2 right-2 bg-red-500 text-white w-8 h-8 rounded-full flex items-center justify-center"
                    >
                      Ã—
                    </button>
                  </div>
                ) : (
                  <div
                    onClick={() => fileInputRef.current?.click()}
                    className="border-2 border-dashed border-gray-300 rounded-lg p-8 text-center cursor-pointer hover:border-green-400 transition"
                  >
                    <div className="text-4xl mb-2">ğŸ“¸</div>
                    <p className="font-medium">FotoÄŸraf yÃ¼klemek iÃ§in tÄ±kla</p>
                    <p className="text-sm text-gray-500 mt-1">
                      ÃœrÃ¼nÃ¼n net fotoÄŸrafÄ±nÄ± Ã§ek, daha hÄ±zlÄ± bulunsun
                    </p>
                  </div>
                )}
                
                <input
                  type="file"
                  ref={fileInputRef}
                  accept="image/*"
                  onChange={handlePhotoUpload}
                  className="hidden"
                  capture="environment"
                />

                <p className="text-xs text-gray-500 mt-2">
                  âœ“ FotoÄŸraflÄ± bildirimler 2x daha hÄ±zlÄ± bulunuyor<br />
                  âœ“ Max 5MB â€¢ PNG, JPG, JPEG, WebP
                </p>
              </div>
            )}
          </div>

          {/* PUAN HESAPLA */}
          <div className="bg-gradient-to-r from-green-50 to-emerald-50 p-4 rounded-lg">
            <div className="flex items-center justify-between">
              <div>
                <p className="font-medium text-green-800">ğŸ¯ Toplam KazanacaÄŸÄ±nÄ±z Puan:</p>
                <div className="text-2xl font-bold text-green-600 mt-1">
                  {calculatePoints()} PUAN
                </div>
              </div>
              <div className="text-3xl">ğŸ†</div>
            </div>
            <div className="text-sm text-green-700 mt-2 space-y-1">
              <div className="flex justify-between">
                <span>Temel bildirim:</span>
                <span className="font-medium">5 puan</span>
              </div>
              {formData.hasPhoto && (
                <div className="flex justify-between">
                  <span>FotoÄŸraf:</span>
                  <span className="font-medium">+10 puan</span>
                </div>
              )}
              {locationData && (
                <div className="flex justify-between">
                  <span>DetaylÄ± konum:</span>
                  <span className="font-medium">+5 puan</span>
                </div>
              )}
              {formData.category && (
                <div className="flex justify-between">
                  <span>Kategori:</span>
                  <span className="font-medium">+3 puan</span>
                </div>
              )}
            </div>
          </div>
        </div>

        {/* Footer */}
        <div className="sticky bottom-0 bg-white border-t p-6">
          <button
            onClick={handleSubmit}
            disabled={loading || !locationData || !formData.description.trim()}
            className="w-full bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 text-white font-bold py-3 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed transition"
          >
            {loading ? (
              <span className="flex items-center justify-center">
                <div className="animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2"></div>
                GÃ¶nderiliyor...
              </span>
            ) : !locationData ? (
              'ğŸ“ Konum SeÃ§in'
            ) : (
              `Bildir ve ${calculatePoints()} Puan Kazan!`
            )}
          </button>
          
          <p className="text-center text-gray-500 text-sm mt-3">
            Bildiriminiz profil sayfanÄ±zda ve ana sayfada gÃ¶rÃ¼necek
          </p>
        </div>
      </div>
    </div>
  )
}




'use client'

import { useState, useEffect, useRef } from 'react'
import { MapPin, Navigation } from 'lucide-react'
import { supabase } from '@/lib/supabase'

interface LocationSelectorProps {
  onLocationSelect: (location: any) => void
  initialLocation?: string
  required?: boolean
}

export default function LocationSelector({ 
  onLocationSelect, 
  initialLocation = '',
  required = true
}: LocationSelectorProps) {
  const [location, setLocation] = useState(initialLocation)
  const [suggestions, setSuggestions] = useState<any[]>([])
  const [isLoading, setIsLoading] = useState(false)
  
  const searchTimeout = useRef<NodeJS.Timeout>()

  useEffect(() => {
    // Ä°lk konum varsa trigger et
    if (initialLocation) {
      handleLocationSelect({ name: initialLocation, address: initialLocation })
    }
  }, [initialLocation])

  const searchLocation = async (query: string) => {
    if (!query || query.length < 2) {
      setSuggestions([])
      return
    }

    setIsLoading(true)
    try {
      // 1. VeritabanÄ±ndan ara
      const { data: dbResults } = await supabase
        .from('locations')
        .select('*')
        .or(`name.ilike.%${query}%,city.ilike.%${query}%,district.ilike.%${query}%`)
        .limit(5)

      // 2. OpenStreetMap API
      const osmResponse = await fetch(
        `https://nominatim.openstreetmap.org/search?q=${encodeURIComponent(query + ' TÃ¼rkiye')}&format=json&addressdetails=1&limit=5`
      )
      const osmResults = await osmResponse.json()

      const allSuggestions = [
        ...(dbResults?.map(loc => ({
          type: 'database',
          name: loc.name,
          address: loc.full_address,
          latitude: loc.latitude,
          longitude: loc.longitude,
          city: loc.city,
          district: loc.district
        })) || []),
        ...(osmResults.map((place: any) => ({
          type: 'osm',
          name: place.display_name.split(',')[0],
          address: place.display_name,
          latitude: parseFloat(place.lat),
          longitude: parseFloat(place.lon),
          city: place.address?.city || place.address?.town || '',
          district: place.address?.suburb || place.address?.county || ''
        })) || [])
      ]

      setSuggestions(allSuggestions.slice(0, 8))
    } catch (error) {
      console.error('Konum arama hatasÄ±:', error)
    } finally {
      setIsLoading(false)
    }
  }

  const handleInputChange = (e: React.ChangeEvent<HTMLInputElement>) => {
    const value = e.target.value
    setLocation(value)
    
    if (searchTimeout.current) {
      clearTimeout(searchTimeout.current)
    }
    
    searchTimeout.current = setTimeout(() => {
      searchLocation(value)
    }, 300)
  }

  const handleSuggestionClick = (suggestion: any) => {
    setLocation(suggestion.address || suggestion.name)
    setSuggestions([])
    handleLocationSelect(suggestion)
  }

  const handleLocationSelect = (location: any) => {
    onLocationSelect({
      name: location.name,
      address: location.address || location.name,
      latitude: location.latitude,
      longitude: location.longitude,
      city: location.city || '',
      district: location.district || ''
    })
  }

  const useCurrentLocation = () => {
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(
        async (position) => {
          const { latitude, longitude } = position.coords
          
          try {
            const response = await fetch(
              `https://nominatim.openstreetmap.org/reverse?lat=${latitude}&lon=${longitude}&format=json`
            )
            const data = await response.json()
            
            const locationObj = {
              name: 'Mevcut Konumum',
              address: data.display_name,
              latitude,
              longitude,
              city: data.address?.city || data.address?.town || '',
              district: data.address?.suburb || data.address?.county || ''
            }
            
            setLocation(data.display_name)
            handleLocationSelect(locationObj)
          } catch (error) {
            console.error('Reverse geocoding hatasÄ±:', error)
          }
        },
        (error) => {
          console.error('Konum alÄ±namadÄ±:', error)
          alert('Konum izni vermeniz gerekiyor')
        }
      )
    }
  }

  const quickLocations = [
    'Ä°stiklal Caddesi, BeyoÄŸlu',
    'KadÄ±kÃ¶y Ã‡arÅŸÄ±, KadÄ±kÃ¶y',
    'BaÄŸdat Caddesi, KadÄ±kÃ¶y',
    'NiÅŸantaÅŸÄ±, ÅiÅŸli',
    'Akmerkez, BeÅŸiktaÅŸ',
    'Kanyon, ÅiÅŸli',
    'Ä°zmir Alsancak',
    'Ankara KÄ±zÄ±lay'
  ]

  return (
    <div className="space-y-3">
      <label className="block text-sm font-medium text-gray-700">
        ğŸ“ Konum {required && '*'}
      </label>
      
      <div className="relative">
        <div className="flex items-center">
          <div className="flex-1 relative">
            <MapPin className="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5" />
            <input
              type="text"
              value={location}
              onChange={handleInputChange}
              placeholder="Ã–rn: Ä°stiklal Caddesi, KadÄ±kÃ¶y Ã‡arÅŸÄ±..."
              className="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
              required={required}
            />
          </div>
          
          <button
            type="button"
            onClick={useCurrentLocation}
            className="ml-2 p-3 bg-blue-100 text-blue-600 rounded-lg hover:bg-blue-200 transition"
            title="Mevcut konumumu kullan"
          >
            <Navigation className="w-5 h-5" />
          </button>
        </div>

        {/* Ã–neriler */}
        {suggestions.length > 0 && (
          <div className="absolute z-10 w-full mt-1 bg-white border border-gray-300 rounded-lg shadow-lg max-h-60 overflow-y-auto">
            {suggestions.map((suggestion, index) => (
              <button
                key={index}
                type="button"
                onClick={() => handleSuggestionClick(suggestion)}
                className="w-full text-left px-4 py-3 hover:bg-gray-50 border-b border-gray-100 last:border-0"
              >
                <div className="font-medium">{suggestion.name}</div>
                <div className="text-sm text-gray-600 truncate">
                  {suggestion.address}
                </div>
                {suggestion.city && (
                  <div className="text-xs text-gray-500 mt-1">
                    {suggestion.district ? `${suggestion.district}, ` : ''}
                    {suggestion.city}
                  </div>
                )}
              </button>
            ))}
          </div>
        )}

        {isLoading && (
          <div className="absolute right-3 top-1/2 transform -translate-y-1/2">
            <div className="animate-spin rounded-full h-5 w-5 border-b-2 border-blue-600"></div>
          </div>
        )}
      </div>

      {/* HÄ±zlÄ± konum butonlarÄ± */}
      <div className="flex flex-wrap gap-2">
        {quickLocations.map((quickLocation) => (
          <button
            key={quickLocation}
            type="button"
            onClick={() => {
              setLocation(quickLocation)
              searchLocation(quickLocation)
            }}
            className="px-3 py-1.5 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-full text-sm transition"
          >
            {quickLocation}
          </button>
        ))}
      </div>

      <p className="text-xs text-gray-500">
        âœ“ Konum bilgisi Ã¼rÃ¼nÃ¼n daha hÄ±zlÄ± bulunmasÄ±nÄ± saÄŸlar<br />
        âœ“ DetaylÄ± adres (sokak, bina no) daha iyi sonuÃ§ verir
      </p>
    </div>
  )
}





'use client'

import { useState } from 'react'
import { useRouter } from 'next/navigation'
import { MapPin, Camera, User, Award } from 'lucide-react'

interface RecentSightingsProps {
  sightings: any[]
}

export default function RecentSightings({ sightings }: RecentSightingsProps) {
  const router = useRouter()
  const [showAll, setShowAll] = useState(false)

  const displaySightings = showAll ? sightings : sightings.slice(0, 4)

  if (sightings.length === 0) {
    return null
  }

  return (
    <section className="py-12 bg-white">
      <div className="container-custom">
        <div className="flex items-center justify-between mb-8">
          <div>
            <h2 className="text-3xl font-bold text-gray-900 mb-2">
              ğŸ‘ï¸ Son GÃ¶rÃ¼lenler
            </h2>
            <p className="text-gray-600">
              TopluluÄŸumuzun en son gÃ¶rdÃ¼ÄŸÃ¼ nadir Ã¼rÃ¼nler
            </p>
          </div>
          
          {sightings.length > 4 && (
            <button
              onClick={() => setShowAll(!showAll)}
              className="text-blue-600 hover:text-blue-800 font-medium"
            >
              {showAll ? 'Daha Az GÃ¶ster' : `TÃ¼mÃ¼nÃ¼ GÃ¶r (${sightings.length})`}
            </button>
          )}
        </div>

        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
          {displaySightings.map((sighting) => (
            <div
              key={sighting.id}
              className="bg-gray-50 rounded-xl border border-gray-200 overflow-hidden hover:shadow-lg transition-shadow duration-300"
            >
              {/* FotoÄŸraf */}
              <div className="h-48 relative bg-gray-100">
                {sighting.photo_url ? (
                  <img
                    src={sighting.photo_url}
                    alt={sighting.description}
                    className="w-full h-full object-cover"
                  />
                ) : (
                  <div className="w-full h-full flex items-center justify-center">
                    <div className="text-center">
                      <Camera className="w-12 h-12 text-gray-400 mx-auto mb-2" />
                      <p className="text-sm text-gray-500">FotoÄŸraf Yok</p>
                    </div>
                  </div>
                )}
                
                {/* Puan badge */}
                <div className="absolute top-3 right-3">
                  <div className="bg-green-600 text-white px-3 py-1 rounded-full text-sm font-bold flex items-center">
                    <Award className="w-3 h-3 mr-1" />
                    +{sighting.points_earned}
                  </div>
                </div>
              </div>

              {/* Ä°Ã§erik */}
              <div className="p-4">
                <p className="font-medium text-gray-900 line-clamp-2 mb-3">
                  {sighting.description}
                </p>
                
                {/* Konum */}
                <div className="flex items-center text-sm text-gray-600 mb-3">
                  <MapPin className="w-4 h-4 mr-1 flex-shrink-0" />
                  <span className="truncate">{sighting.location_name}</span>
                </div>
                
                {/* KullanÄ±cÄ± */}
                <div className="flex items-center justify-between">
                  <div className="flex items-center">
                    <div className="w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center text-blue-600 font-bold mr-2">
                      {sighting.user?.name?.[0] || 'K'}
                    </div>
                    <span className="text-sm text-gray-700">
                      {sighting.user?.name || 'KullanÄ±cÄ±'}
                    </span>
                  </div>
                  
                  <button
                    onClick={() => router.push(`/sightings/${sighting.id}`)}
                    className="text-blue-600 hover:text-blue-800 text-sm font-medium"
                  >
                    Detay â†’
                  </button>
                </div>
                
                {/* Kategori */}
                {sighting.category && (
                  <div className="mt-3">
                    <span className="inline-block bg-gray-200 text-gray-700 text-xs px-2 py-1 rounded">
                      {sighting.category}
                    </span>
                  </div>
                )}
              </div>
            </div>
          ))}
        </div>

        {/* Ben de arÄ±yorum CTA */}
        <div className="mt-10 bg-gradient-to-r from-blue-50 to-blue-100 rounded-2xl p-8 text-center">
          <h3 className="text-xl font-bold text-gray-900 mb-3">
            Bu Ã¼rÃ¼nlerden birini siz de mi arÄ±yorsunuz?
          </h3>
          <p className="text-gray-700 mb-6">
            "Ben de arÄ±yorum" deyin, spot oluÅŸturalÄ±m ve bulalÄ±m!
          </p>
          <div className="flex flex-col sm:flex-row gap-4 justify-center">
            <button
              onClick={() => router.push('/create-spot')}
              className="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-8 rounded-lg"
            >
              Spot OluÅŸtur
            </button>
            <button
              onClick={() => router.push('/recent-sightings')}
              className="bg-white hover:bg-gray-100 text-gray-800 font-bold py-3 px-8 rounded-lg border"
            >
              TÃ¼m GÃ¶rÃ¼lenleri Ä°ncele
            </button>
          </div>
        </div>
      </div>
    </section>
  )
}


// app/profile/[id]/page.tsx - DÃœZELTÄ°LMÄ°Å
'use client'

import { useState, useEffect } from 'react'
import { useParams, useRouter } from 'next/navigation'
import { supabase } from '@/lib/supabase'
import Header from '@/components/Header'
import Footer from '@/components/Footer'
import UserProfileCard from '@/components/UserProfileCard'
import SimpleTabs from '@/components/SimpleTabs' // Yeni component

interface UserProfile {
  id: string
  name: string
  email: string
  avatar_url: string | null
  bio: string | null
  location: string | null
  created_at: string
}

export default function UserProfilePage() {
  const params = useParams()
  const router = useRouter()
  const userId = params.id as string
  
  const [user, setUser] = useState<UserProfile | null>(null)
  const [sightings, setSightings] = useState<any[]>([])
  const [spots, setSpots] = useState<any[]>([])
  const [loading, setLoading] = useState(true)
  const [activeTab, setActiveTab] = useState<'sightings' | 'spots' | 'reputation'>('sightings')
  const [isCurrentUser, setIsCurrentUser] = useState(false)

  const tabs = [
    { id: 'sightings', label: `ğŸ‘ï¸ GÃ¶rÃ¼lenler (${sightings.length})` },
    { id: 'spots', label: `ğŸ“ Spot'lar (${spots.length})` },
    { id: 'reputation', label: 'ğŸ† Puan & Rozetler' }
  ]

  useEffect(() => {
    if (userId) {
      fetchUserData()
    }
  }, [userId])

  const fetchUserData = async () => {
    try {
      // Mevcut kullanÄ±cÄ± kontrolÃ¼
      const { data: { user: currentUser } } = await supabase.auth.getUser()
      setIsCurrentUser(currentUser?.id === userId)

      // KullanÄ±cÄ± bilgileri
      const { data: userData } = await supabase
        .from('user_profiles')
        .select('*')
        .eq('id', userId)
        .single()

      // Sightings
      const { data: sightingsData } = await supabase
        .from('quick_sightings')
        .select('*')
        .eq('user_id', userId)
        .eq('status', 'active')
        .order('created_at', { ascending: false })

      // Spots
      const { data: spotsData } = await supabase
        .from('spots')
        .select('*')
        .eq('user_id', userId)
        .order('created_at', { ascending: false })

      setUser(userData)
      setSightings(sightingsData || [])
      setSpots(spotsData || [])
    } catch (error) {
      console.error('Profil yÃ¼klenemedi:', error)
    } finally {
      setLoading(false)
    }
  }

  if (loading) {
    return (
      <div className="min-h-screen bg-gray-50">
        <Header />
        <main className="container-custom py-12 text-center">
          <div className="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-600 mx-auto"></div>
          <p className="mt-4 text-gray-600">YÃ¼kleniyor...</p>
        </main>
        <Footer />
      </div>
    )
  }

  if (!user) {
    return (
      <div className="min-h-screen bg-gray-50">
        <Header />
        <main className="container-custom py-12 text-center">
          <h1 className="text-2xl font-bold text-gray-900 mb-4">KullanÄ±cÄ± bulunamadÄ±</h1>
          <button
            onClick={() => router.push('/')}
            className="text-blue-600 hover:text-blue-800"
          >
            Ana sayfaya dÃ¶n
          </button>
        </main>
        <Footer />
      </div>
    )
  }

  return (
    <div className="min-h-screen bg-gray-50">
      <Header />
      
      <main className="container-custom py-8">
        {/* Ãœst Bilgi */}
        <div className="bg-gradient-to-r from-blue-500 to-purple-600 rounded-2xl p-8 text-white mb-8">
          <div className="flex items-center justify-between">
            <div className="flex items-center space-x-6">
              <div className="relative">
                <div className="w-24 h-24 bg-white rounded-full flex items-center justify-center">
                  {user.avatar_url ? (
                    <img
                      src={user.avatar_url}
                      alt={user.name}
                      className="w-full h-full rounded-full object-cover"
                    />
                  ) : (
                    <div className="text-3xl font-bold text-blue-600">
                      {user.name[0].toUpperCase()}
                    </div>
                  )}
                </div>
                <div className="absolute -bottom-2 -right-2 bg-green-500 text-white px-3 py-1 rounded-full text-sm font-bold">
                  ğŸ‘ï¸ {sightings.length}
                </div>
              </div>
              
              <div>
                <h1 className="text-3xl font-bold mb-2">{user.name}</h1>
                {user.bio && <p className="text-blue-100">{user.bio}</p>}
                {user.location && (
                  <p className="text-blue-100 text-sm mt-2">ğŸ“ {user.location}</p>
                )}
                <p className="text-blue-100 text-sm mt-2">
                  Ãœyelik: {new Date(user.created_at).toLocaleDateString('tr-TR')}
                </p>
              </div>
            </div>
            
            {isCurrentUser && (
              <button
                onClick={() => router.push('/profile/edit')}
                className="bg-white text-blue-600 hover:bg-gray-100 font-bold py-2 px-6 rounded-lg"
              >
                Profili DÃ¼zenle
              </button>
            )}
          </div>
        </div>

        {/* Ä°statistikler */}
        <div className="grid grid-cols-2 md:grid-cols-4 gap-6 mb-8">
          <div className="bg-white rounded-xl p-6 shadow text-center">
            <div className="text-2xl font-bold text-blue-600 mb-2">
              {sightings.length}
            </div>
            <div className="text-gray-600">GÃ¶rÃ¼len ÃœrÃ¼n</div>
          </div>
          <div className="bg-white rounded-xl p-6 shadow text-center">
            <div className="text-2xl font-bold text-green-600 mb-2">
              {spots.length}
            </div>
            <div className="text-gray-600">OluÅŸturulan Spot</div>
          </div>
          <div className="bg-white rounded-xl p-6 shadow text-center">
            <div className="text-2xl font-bold text-purple-600 mb-2">
              {sightings.filter(s => s.has_photo).length}
            </div>
            <div className="text-gray-600">FotoÄŸraflÄ± Bildirim</div>
          </div>
          <div className="bg-white rounded-xl p-6 shadow text-center">
            <div className="text-2xl font-bold text-orange-600 mb-2">
              {sightings.reduce((sum, s) => sum + s.points_earned, 0)}
            </div>
            <div className="text-gray-600">Toplam Puan</div>
          </div>
        </div>

        {/* Tab'ler */}
        <div className="bg-white rounded-xl shadow mb-6">
          <SimpleTabs 
            tabs={tabs}
            activeTab={activeTab}
            onTabChange={setActiveTab}
          />
        </div>

        {/* Ä°Ã§erik */}
        <div className="min-h-[400px]">
          {activeTab === 'sightings' && (
            <div className="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
              {sightings.length === 0 ? (
                <div className="col-span-full text-center py-12">
                  <div className="text-4xl mb-4">ğŸ‘ï¸</div>
                  <h3 className="text-xl font-bold text-gray-900 mb-2">
                    HenÃ¼z gÃ¶rÃ¼len Ã¼rÃ¼n yok
                  </h3>
                  <p className="text-gray-600">
                    {isCurrentUser 
                      ? 'Ä°lk "Nadir GÃ¶rdÃ¼m" bildirimini sen yap!'
                      : 'Bu kullanÄ±cÄ± henÃ¼z bildirim yapmamÄ±ÅŸ'}
                  </p>
                </div>
              ) : (
                sightings.map((sighting) => (
                  <div
                    key={sighting.id}
                    className="bg-white rounded-xl border border-gray-200 overflow-hidden hover:shadow-lg transition"
                  >
                    {sighting.photo_url && (
                      <div className="h-48">
                        <img
                          src={sighting.photo_url}
                          alt={sighting.description}
                          className="w-full h-full object-cover"
                        />
                      </div>
                    )}
                    
                    <div className="p-4">
                      <p className="font-medium mb-3">{sighting.description}</p>
                      
                      <div className="flex items-center text-sm text-gray-600 mb-3">
                        <span className="mr-2">ğŸ“</span>
                        <span className="truncate">{sighting.location_name}</span>
                      </div>
                      
                      <div className="flex justify-between items-center">
                        <div className="text-sm text-gray-500">
                          {new Date(sighting.created_at).toLocaleDateString('tr-TR')}
                        </div>
                        <div className="text-green-600 font-bold">
                          +{sighting.points_earned} puan
                        </div>
                      </div>
                    </div>
                  </div>
                ))
              )}
            </div>
          )}

          {activeTab === 'spots' && (
            <div className="bg-white rounded-xl shadow p-6">
              <h3 className="font-bold text-lg mb-4">Spot'lar</h3>
              {spots.length === 0 ? (
                <p className="text-gray-600 text-center py-8">
                  HenÃ¼z spot oluÅŸturulmamÄ±ÅŸ
                </p>
              ) : (
                <div className="space-y-4">
                  {spots.map((spot) => (
                    <div key={spot.id} className="border-b pb-4">
                      <h4 className="font-medium">{spot.title}</h4>
                      <p className="text-sm text-gray-600">{spot.description}</p>
                    </div>
                  ))}
                </div>
              )}
            </div>
          )}

          {activeTab === 'reputation' && (
            <div className="bg-white rounded-xl shadow p-6">
              <UserProfileCard userId={userId} />
            </div>
          )}
        </div>
      </main>

      <Footer />
    </div>
  )
}



// lib/supabase/server.ts - DÃœZELTÄ°LMÄ°Å
import { createServerClient, type CookieOptions } from '@supabase/ssr'
import { cookies } from 'next/headers'

type Cookie = {
  name: string
  value: string
  options: CookieOptions
}

export function createClient() {
  const cookieStore = cookies()

  return createServerClient(
    process.env.NEXT_PUBLIC_SUPABASE_URL!,
    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,
    {
      cookies: {
        getAll() {
          return cookieStore.getAll()
        },
        setAll(cookiesToSet: Cookie[]) {
          try {
            cookiesToSet.forEach(({ name, value, options }) =>
              cookieStore.set(name, value, options)
            )
          } catch {
            // Ignore
          }
        },
      },
    }
  )
}



// lib/supabase/client.ts - DÃœZELTÄ°LMÄ°Å
import { createBrowserClient as createSupabaseBrowserClient } from '@supabase/ssr'

export function createBrowserClient() {
  return createSupabaseBrowserClient(
    process.env.NEXT_PUBLIC_SUPABASE_URL!,
    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!
  )
}



// components/SimpleTabs.tsx - DÃœZELTÄ°LMÄ°Å
'use client'

interface Tab {
  id: string
  label: string
}

interface SimpleTabsProps {
  tabs: Tab[]
  activeTab: string
  onTabChange: (tabId: string) => void
}

export default function SimpleTabs({ tabs, activeTab, onTabChange }: SimpleTabsProps) {
  return (
    <div className="flex border-b">
      {tabs.map((tab) => (
        <button
          key={tab.id}
          onClick={() => onTabChange(tab.id)}
          className={`flex-1 py-4 text-center font-medium transition-colors ${
            activeTab === tab.id
              ? 'text-blue-600 border-b-2 border-blue-600'
              : 'text-gray-600 hover:text-gray-900 hover:bg-gray-50'
          }`}
        >
          {tab.label}
        </button>
      ))}
    </div>
  )
}




// lib/supabase/index.ts
// Client-side iÃ§in default export
export { createBrowserClient } from './client'

// Server-side iÃ§in ayrÄ± fonksiyon
export { createClient } from './server'







// components/ImageUpload.tsx
'use client'

import { useRef, useState } from 'react'

interface ImageUploadProps {
  onImagesSelected: (files: File[]) => void
  maxImages?: number
}

export default function ImageUpload({ 
  onImagesSelected, 
  maxImages = 10 
}: ImageUploadProps) {
  const fileInputRef = useRef<HTMLInputElement>(null)
  const [previews, setPreviews] = useState<string[]>([])

  const handleFileSelect = (e: React.ChangeEvent<HTMLInputElement>) => {
    const files = Array.from(e.target.files || [])
    const validFiles = files.slice(0, maxImages - previews.length)
    
    if (validFiles.length === 0) return
    
    // Preview oluÅŸtur
    const newPreviews = validFiles.map(file => URL.createObjectURL(file))
    setPreviews(prev => [...prev, ...newPreviews])
    
    onImagesSelected(validFiles)
  }

  const removeImage = (index: number) => {
    setPreviews(prev => prev.filter((_, i) => i !== index))
  }

  return (
    <div>
      <input
        type="file"
        ref={fileInputRef}
        multiple
        accept="image/*"
        onChange={handleFileSelect}
        className="hidden"
      />
      
      <div className="grid grid-cols-3 gap-4">
        {previews.map((preview, index) => (
          <div key={index} className="relative">
            <img
              src={preview}
              alt={`Preview ${index + 1}`}
              className="w-full h-32 object-cover rounded-lg"
            />
            <button
              type="button"
              onClick={() => removeImage(index)}
              className="absolute top-1 right-1 bg-red-500 text-white w-6 h-6 rounded-full text-sm"
            >
              Ã—
            </button>
          </div>
        ))}
        
        {previews.length < maxImages && (
          <button
            type="button"
            onClick={() => fileInputRef.current?.click()}
            className="w-full h-32 border-2 border-dashed border-gray-300 rounded-lg flex flex-col items-center justify-center hover:border-blue-400 transition"
          >
            <div className="text-2xl mb-2">+</div>
            <div className="text-sm text-gray-600">Resim Ekle</div>
          </button>
        )}
      </div>
    </div>
  )
}



// app/discovery/page.tsx - DÃœZELTÄ°LMÄ°Å
'use client'

import { useState } from 'react'
import Header from '@/components/Header'
import Footer from '@/components/Footer'
import Feed from '@/components/social/Feed'
import CreatePostModal from '@/components/social/CreatePostModal'

// Basit placeholder component'ler
function TrendingHashtags() {
  return (
    <div className="bg-white rounded-xl shadow p-6">
      <h3 className="font-bold text-gray-900 mb-4">ğŸ”¥ PopÃ¼ler Hashtag'ler</h3>
      <div className="space-y-2">
        {['#vintage', '#kamera', '#antika', '#koleksiyon'].map((tag) => (
          <div key={tag} className="flex justify-between items-center p-2 hover:bg-gray-50 rounded">
            <span className="text-blue-600">{tag}</span>
            <span className="text-sm text-gray-500">42 paylaÅŸÄ±m</span>
          </div>
        ))}
      </div>
    </div>
  )
}

function SuggestedUsers() {
  return (
    <div className="bg-white rounded-xl shadow p-6">
      <h3 className="font-bold text-gray-900 mb-4">ğŸ‘¥ Ã–nerilen KullanÄ±cÄ±lar</h3>
      <div className="space-y-3">
        {['Ahmet Y.', 'Zeynep K.', 'Mehmet T.'].map((user) => (
          <div key={user} className="flex items-center justify-between">
            <div className="flex items-center space-x-3">
              <div className="w-10 h-10 rounded-full bg-blue-100"></div>
              <span>{user}</span>
            </div>
            <button className="text-blue-600 text-sm">Takip Et</button>
          </div>
        ))}
      </div>
    </div>
  )
}

export default function DiscoveryPage() {
  const [showCreateModal, setShowCreateModal] = useState(false)

  return (
    <div className="min-h-screen bg-gray-50">
      <Header />
      
      <CreatePostModal
        isOpen={showCreateModal}
        onClose={() => setShowCreateModal(false)}
        onPostCreated={() => console.log('post created')}
      />

      <div className="container-custom py-8">
        <div className="grid lg:grid-cols-3 gap-8">
          {/* Ana Feed */}
          <div className="lg:col-span-2">
            <div className="mb-6">
              <h1 className="text-3xl font-bold text-gray-900 mb-2">
                ğŸ¯ KeÅŸfet
              </h1>
              <p className="text-gray-600">
                TopluluÄŸumuzun keÅŸiflerini, koleksiyonlarÄ±nÄ± ve nadir buluÅŸlarÄ±nÄ± takip edin
              </p>
            </div>

            {/* CTA Butonu */}
            <div className="bg-gradient-to-r from-blue-500 to-purple-600 rounded-2xl p-6 text-white mb-8">
              <div className="flex items-center justify-between">
                <div>
                  <h3 className="text-xl font-bold mb-2">Nadir bir ÅŸey mi gÃ¶rdÃ¼n?</h3>
                  <p>PaylaÅŸ, topluluÄŸa ilham ver, puan kazan!</p>
                </div>
                <button
                  onClick={() => setShowCreateModal(true)}
                  className="bg-white text-blue-600 hover:bg-gray-100 font-bold py-3 px-6 rounded-lg"
                >
                  ğŸ“¸ PaylaÅŸÄ±m Yap
                </button>
              </div>
            </div>

            {/* Feed */}
            <Feed type="for-you" />
          </div>

          {/* SaÄŸ Sidebar */}
          <div className="space-y-6">
            {/* Profil kartÄ± */}
            <div className="bg-white rounded-xl shadow p-6">
              <div className="flex items-center space-x-3">
                <div className="w-16 h-16 bg-gradient-to-br from-blue-400 to-purple-500 rounded-full"></div>
                <div>
                  <h3 className="font-bold text-gray-900">Profilin</h3>
                  <p className="text-sm text-gray-600">KeÅŸfet, paylaÅŸ, puan kazan</p>
                </div>
              </div>
              
              <div className="mt-4 grid grid-cols-3 gap-2 text-center">
                <div>
                  <div className="font-bold text-lg">0</div>
                  <div className="text-xs text-gray-600">PaylaÅŸÄ±m</div>
                </div>
                <div>
                  <div className="font-bold text-lg">0</div>
                  <div className="text-xs text-gray-600">TakipÃ§i</div>
                </div>
                <div>
                  <div className="font-bold text-lg">0</div>
                  <div className="text-xs text-gray-600">Takip</div>
                </div>
              </div>

              <button
                onClick={() => setShowCreateModal(true)}
                className="w-full mt-4 bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 rounded-lg"
              >
                PaylaÅŸÄ±m Yap
              </button>
            </div>

            {/* Trending Hashtags */}
            <TrendingHashtags />

            {/* Ã–nerilen KullanÄ±cÄ±lar */}
            <SuggestedUsers />

            {/* HÄ±zlÄ± Ä°puÃ§larÄ± */}
            <div className="bg-gradient-to-br from-green-50 to-emerald-50 rounded-xl p-6 border border-green-100">
              <h4 className="font-bold text-gray-900 mb-3">ğŸ’¡ KeÅŸif Ä°puÃ§larÄ±</h4>
              <ul className="space-y-2 text-sm">
                <li className="flex items-start">
                  <span className="mr-2">âœ…</span>
                  <span>Hashtag kullan daha Ã§ok kiÅŸiye ulaÅŸ</span>
                </li>
                <li className="flex items-start">
                  <span className="mr-2">âœ…</span>
                  <span>FotoÄŸraflÄ± paylaÅŸÄ±mlar 2x daha fazla etkileÅŸim alÄ±r</span>
                </li>
                <li className="flex items-start">
                  <span className="mr-2">âœ…</span>
                  <span>GÃ¼nlÃ¼k paylaÅŸÄ±m yaparak puan kazan</span>
                </li>
              </ul>
            </div>
          </div>
        </div>
      </div>

      <Footer />
    </div>
  )
}




// components/RecentSightings.tsx - GÃœNCELLENMÄ°Å
'use client'

import { useState, useEffect } from 'react'
import { useRouter } from 'next/navigation'
import { supabase } from '@/lib/supabase' // ESKÄ° VERSÄ°YONU KULLAN
import { MapPin, Camera, Award } from 'lucide-react'

interface RecentSightingsProps {
  initialSightings?: any[] // Opsiyonel: Server'dan gelebilir
}

export default function RecentSightings({ initialSightings = [] }: RecentSightingsProps) {
  const router = useRouter()
  const [sightings, setSightings] = useState<any[]>(initialSightings)
  const [loading, setLoading] = useState(!initialSightings.length)
  const [showAll, setShowAll] = useState(false)

  useEffect(() => {
    if (!initialSightings.length) {
      fetchSightings()
    }
  }, [])

  const fetchSightings = async () => {
    try {
      const { data } = await supabase
        .from('quick_sightings')
        .select(`
          *,
          user:user_profiles(name, avatar_url)
        `)
        .eq('status', 'active')
        .order('created_at', { ascending: false })
        .limit(6)
      
      setSightings(data || [])
    } catch (error) {
      console.error('Sightings yÃ¼klenemedi:', error)
    } finally {
      setLoading(false)
    }
  }

  const displaySightings = showAll ? sightings : sightings.slice(0, 4)

  if (loading) {
    return (
      <section className="py-12 bg-white">
        <div className="container-custom">
          <h2 className="text-3xl font-bold text-gray-900 mb-8">ğŸ‘ï¸ Son GÃ¶rÃ¼lenler</h2>
          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
            {[...Array(4)].map((_, i) => (
              <div key={i} className="animate-pulse bg-gray-100 rounded-xl h-64"></div>
            ))}
          </div>
        </div>
      </section>
    )
  }

  if (sightings.length === 0) {
    return null // HiÃ§ sighting yoksa gÃ¶zÃ¼kmesin
  }

  return (
    <section className="py-12 bg-white">
      <div className="container-custom">
        <div className="flex items-center justify-between mb-8">
          <div>
            <h2 className="text-3xl font-bold text-gray-900 mb-2">
              ğŸ‘ï¸ Son GÃ¶rÃ¼lenler
            </h2>
            <p className="text-gray-600">
              TopluluÄŸumuzun en son gÃ¶rdÃ¼ÄŸÃ¼ nadir Ã¼rÃ¼nler
            </p>
          </div>
          
          {sightings.length > 4 && (
            <button
              onClick={() => setShowAll(!showAll)}
              className="text-blue-600 hover:text-blue-800 font-medium"
            >
              {showAll ? 'Daha Az GÃ¶ster' : `TÃ¼mÃ¼nÃ¼ GÃ¶r (${sightings.length})`}
            </button>
          )}
        </div>

        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
          {displaySightings.map((sighting) => (
            <div
              key={sighting.id}
              className="bg-gray-50 rounded-xl border border-gray-200 overflow-hidden hover:shadow-lg transition-shadow duration-300 cursor-pointer"
              onClick={() => router.push(`/sightings/${sighting.id}`)}
            >
              {/* FotoÄŸraf */}
              <div className="h-48 relative bg-gray-100">
                {sighting.photo_url ? (
                  <img
                    src={sighting.photo_url}
                    alt={sighting.description}
                    className="w-full h-full object-cover"
                  />
                ) : (
                  <div className="w-full h-full flex items-center justify-center">
                    <div className="text-center">
                      <Camera className="w-12 h-12 text-gray-400 mx-auto mb-2" />
                      <p className="text-sm text-gray-500">FotoÄŸraf Yok</p>
                    </div>
                  </div>
                )}
                
                {/* Puan badge */}
                <div className="absolute top-3 right-3">
                  <div className="bg-green-600 text-white px-3 py-1 rounded-full text-sm font-bold flex items-center">
                    <Award className="w-3 h-3 mr-1" />
                    +{sighting.points_earned}
                  </div>
                </div>
              </div>

              {/* Ä°Ã§erik */}
              <div className="p-4">
                <p className="font-medium text-gray-900 line-clamp-2 mb-3">
                  {sighting.description}
                </p>
                
                {/* Konum */}
                <div className="flex items-center text-sm text-gray-600 mb-3">
                  <MapPin className="w-4 h-4 mr-1 flex-shrink-0" />
                  <span className="truncate">{sighting.location_name}</span>
                </div>
                
                {/* KullanÄ±cÄ± */}
                <div className="flex items-center justify-between">
                  <div className="flex items-center">
                    <div className="w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center text-blue-600 font-bold mr-2">
                      {sighting.user?.name?.[0] || 'K'}
                    </div>
                    <span className="text-sm text-gray-700">
                      {sighting.user?.name || 'KullanÄ±cÄ±'}
                    </span>
                  </div>
                  
                  <span className="text-blue-600 text-sm font-medium">
                    Detay â†’
                  </span>
                </div>
                
                {/* Kategori */}
                {sighting.category && (
                  <div className="mt-3">
                    <span className="inline-block bg-gray-200 text-gray-700 text-xs px-2 py-1 rounded">
                      {sighting.category}
                    </span>
                  </div>
                )}
              </div>
            </div>
          ))}
        </div>

        {/* Ben de arÄ±yorum CTA */}
        <div className="mt-10 bg-gradient-to-r from-blue-50 to-blue-100 rounded-2xl p-8 text-center">
          <h3 className="text-xl font-bold text-gray-900 mb-3">
            Bu Ã¼rÃ¼nlerden birini siz de mi arÄ±yorsunuz?
          </h3>
          <p className="text-gray-700 mb-6">
            "Ben de arÄ±yorum" deyin, spot oluÅŸturalÄ±m ve bulalÄ±m!
          </p>
          <div className="flex flex-col sm:flex-row gap-4 justify-center">
            <button
              onClick={() => router.push('/create-spot')}
              className="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-8 rounded-lg"
            >
              Spot OluÅŸtur
            </button>
            <button
              onClick={() => router.push('/recent-sightings')}
              className="bg-white hover:bg-gray-100 text-gray-800 font-bold py-3 px-8 rounded-lg border"
            >
              TÃ¼m GÃ¶rÃ¼lenleri Ä°ncele
            </button>
          </div>
        </div>
      </div>
    </section>
  )
}



// components/social/CommentsSection.tsx
'use client'

import { useState, useEffect, useRef } from 'react'
import { supabase } from '@/lib/supabase'
import { Send, Heart, MoreVertical, Smile } from 'lucide-react'

interface CommentsSectionProps {
  postId: string
  initialComments?: any[]
  onClose?: () => void
  autoFocus?: boolean
}

export default function CommentsSection({ 
  postId, 
  initialComments = [], 
  onClose,
  autoFocus = false 
}: CommentsSectionProps) {
  const [comments, setComments] = useState<any[]>(initialComments)
  const [newComment, setNewComment] = useState('')
  const [loading, setLoading] = useState(false)
  const [replyingTo, setReplyingTo] = useState<string | null>(null)
  const [showEmojiPicker, setShowEmojiPicker] = useState(false)
  
  const commentsEndRef = useRef<HTMLDivElement>(null)
  const inputRef = useRef<HTMLTextAreaElement>(null)

  useEffect(() => {
    if (initialComments.length === 0) {
      fetchComments()
    }
  }, [postId])

  useEffect(() => {
    scrollToBottom()
  }, [comments])

  const fetchComments = async () => {
    try {
      const { data } = await supabase
        .from('social_comments')
        .select(`
          *,
          user:user_profiles(*)
        `)
        .eq('post_id', postId)
        .order('created_at', { ascending: true })

      setComments(data || [])
    } catch (error) {
      console.error('Yorumlar yÃ¼klenemedi:', error)
    }
  }

  const scrollToBottom = () => {
    commentsEndRef.current?.scrollIntoView({ behavior: 'smooth' })
  }

  const handleSubmitComment = async () => {
    if (!newComment.trim()) return

    setLoading(true)
    try {
      const { data: { user } } = await supabase.auth.getUser()
      if (!user) {
        alert('Yorum yapmak iÃ§in giriÅŸ yapmalÄ±sÄ±nÄ±z')
        return
      }

      const { data: comment, error } = await supabase
        .from('social_comments')
        .insert({
          post_id: postId,
          user_id: user.id,
          content: newComment,
          parent_id: replyingTo || null
        })
        .select(`
          *,
          user:user_profiles(*)
        `)
        .single()

      if (error) throw error

      // Yeni yorumu listeye ekle
      setComments(prev => [...prev, comment])
      setNewComment('')
      setReplyingTo(null)

      // Bildirim gÃ¶nder (post sahibine)
      const postOwnerId = comments[0]?.post?.user_id || postId
      if (postOwnerId !== user.id) {
        await supabase.from('social_notifications').insert({
          user_id: postOwnerId,
          type: 'comment',
          actor_id: user.id,
          post_id: postId,
          message: 'paylaÅŸÄ±mÄ±na yorum yaptÄ±'
        })
      }

      // Emoji picker'Ä± kapat
      setShowEmojiPicker(false)

    } catch (error) {
      console.error('Yorum gÃ¶nderme hatasÄ±:', error)
      alert('Yorum gÃ¶nderilemedi')
    } finally {
      setLoading(false)
    }
  }

  const handleLikeComment = async (commentId: string) => {
    try {
      const { data: { user } } = await supabase.auth.getUser()
      if (!user) return

      // BeÄŸeni iÅŸlemi (like/unlike)
      const existingLike = comments.find(c => c.id === commentId)?.liked_by_user
      
      if (existingLike) {
        // BeÄŸeniyi kaldÄ±r
        await supabase
          .from('comment_likes')
          .delete()
          .eq('comment_id', commentId)
          .eq('user_id', user.id)
      } else {
        // BeÄŸen
        await supabase
          .from('comment_likes')
          .insert({
            comment_id: commentId,
            user_id: user.id
          })
      }

      // UI gÃ¼ncelle
      setComments(prev => prev.map(comment => {
        if (comment.id === commentId) {
          return {
            ...comment,
            like_count: existingLike ? comment.like_count - 1 : comment.like_count + 1,
            liked_by_user: !existingLike
          }
        }
        return comment
      }))

    } catch (error) {
      console.error('Yorum beÄŸenme hatasÄ±:', error)
    }
  }

  const handleReply = (commentId: string, username: string) => {
    setReplyingTo(commentId)
    setNewComment(`@${username} `)
    inputRef.current?.focus()
  }

  const addEmoji = (emoji: string) => {
    setNewComment(prev => prev + emoji)
    setShowEmojiPicker(false)
  }

  const emojis = ['ğŸ˜Š', 'ğŸ˜', 'ğŸ˜‚', 'ğŸ˜®', 'ğŸ˜¢', 'ğŸ‘', 'â¤ï¸', 'ğŸ”¥', 'ğŸ‰', 'ğŸ‘']

  const renderComment = (comment: any, isChild = false) => {
    const childComments = comments.filter(c => c.parent_id === comment.id)
    
    return (
      <div key={comment.id} className={`${isChild ? 'ml-8' : ''}`}>
        <div className={`flex space-x-3 ${isChild ? 'mt-3' : 'mt-4'}`}>
          {/* Avatar */}
          <div className="flex-shrink-0">
            <div className="w-8 h-8 rounded-full bg-gradient-to-br from-blue-400 to-purple-500 overflow-hidden">
              {comment.user?.avatar_url ? (
                <img
                  src={comment.user.avatar_url}
                  alt={comment.user?.name}
                  className="w-full h-full object-cover"
                />
              ) : (
                <div className="w-full h-full flex items-center justify-center text-white text-sm font-bold">
                  {comment.user?.name?.[0] || 'K'}
                </div>
              )}
            </div>
          </div>

          {/* Ä°Ã§erik */}
          <div className="flex-1">
            <div className="bg-gray-100 rounded-2xl rounded-tl-none p-3">
              <div className="flex items-center justify-between mb-1">
                <div className="flex items-center space-x-2">
                  <span className="font-bold text-sm">{comment.user?.name || 'KullanÄ±cÄ±'}</span>
                  <span className="text-xs text-gray-500">
                    {new Date(comment.created_at).toLocaleTimeString('tr-TR', {
                      hour: '2-digit',
                      minute: '2-digit'
                    })}
                  </span>
                </div>
                
                <div className="relative">
                  <button
                    onClick={() => console.log('comment menu')}
                    className="p-1 hover:bg-gray-200 rounded-full"
                  >
                    <MoreVertical className="w-3 h-3 text-gray-500" />
                  </button>
                </div>
              </div>

              <p className="text-gray-800 text-sm whitespace-pre-line">
                {comment.content}
              </p>
            </div>

            {/* Aksiyonlar */}
            <div className="flex items-center space-x-4 mt-2 ml-3">
              <button
                onClick={() => handleLikeComment(comment.id)}
                className={`text-xs flex items-center space-x-1 ${
                  comment.liked_by_user ? 'text-red-600' : 'text-gray-500'
                }`}
              >
                <Heart className="w-3 h-3" />
                <span>{comment.like_count || 0}</span>
              </button>
              
              <button
                onClick={() => handleReply(comment.id, comment.user?.name)}
                className="text-xs text-gray-500 hover:text-gray-700"
              >
                YanÄ±tla
              </button>
              
              {!isChild && childComments.length > 0 && (
                <button className="text-xs text-blue-600">
                  {childComments.length} yanÄ±t
                </button>
              )}
            </div>

            {/* Alt yorumlar */}
            {childComments.length > 0 && (
              <div className="mt-3">
                {childComments.map(child => renderComment(child, true))}
              </div>
            )}
          </div>
        </div>
      </div>
    )
  }

  return (
    <div className="border-t border-gray-100">
      {/* Yorumlar listesi */}
      <div className="max-h-80 overflow-y-auto px-6 py-4">
        {comments.length === 0 ? (
          <div className="text-center py-8">
            <div className="text-3xl mb-3">ğŸ’¬</div>
            <p className="text-gray-600">HenÃ¼z yorum yok</p>
            <p className="text-sm text-gray-500 mt-1">Ä°lk yorumu sen yap!</p>
          </div>
        ) : (
          <div>
            {comments
              .filter(comment => !comment.parent_id) // Sadece parent yorumlar
              .map(comment => renderComment(comment, false))}
          </div>
        )}
        
        <div ref={commentsEndRef} />
      </div>

      {/* YanÄ±tlama durumu */}
      {replyingTo && (
        <div className="px-6 py-2 bg-blue-50 flex items-center justify-between">
          <div className="text-sm text-blue-700">
            YanÄ±tlanÄ±yor: @{comments.find(c => c.id === replyingTo)?.user?.name}
          </div>
          <button
            onClick={() => setReplyingTo(null)}
            className="text-sm text-gray-500 hover:text-gray-700"
          >
            Ã— Ä°ptal
          </button>
        </div>
      )}

      {/* Yorum input */}
      <div className="px-6 py-4 border-t border-gray-100">
        <div className="flex space-x-3">
          {/* Emoji picker */}
          <div className="relative">
            <button
              onClick={() => setShowEmojiPicker(!showEmojiPicker)}
              className="p-2 hover:bg-gray-100 rounded-full"
            >
              <Smile className="w-5 h-5 text-gray-500" />
            </button>

            {showEmojiPicker && (
              <div className="absolute bottom-full left-0 mb-2 bg-white rounded-xl shadow-lg border p-2 grid grid-cols-5 gap-1 z-50">
                {emojis.map(emoji => (
                  <button
                    key={emoji}
                    onClick={() => addEmoji(emoji)}
                    className="w-8 h-8 hover:bg-gray-100 rounded flex items-center justify-center text-lg"
                  >
                    {emoji}
                  </button>
                ))}
              </div>
            )}
          </div>

          {/* Textarea */}
          <div className="flex-1">
            <textarea
              ref={inputRef}
              value={newComment}
              onChange={(e) => setNewComment(e.target.value)}
              placeholder="Yorum ekle..."
              className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 resize-none"
              rows={2}
              autoFocus={autoFocus}
              onKeyDown={(e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                  e.preventDefault()
                  handleSubmitComment()
                }
              }}
            />
          </div>

          {/* GÃ¶nder butonu */}
          <button
            onClick={handleSubmitComment}
            disabled={loading || !newComment.trim()}
            className="self-end bg-blue-600 hover:bg-blue-700 text-white p-3 rounded-full disabled:opacity-50 disabled:cursor-not-allowed"
          >
            {loading ? (
              <div className="animate-spin rounded-full h-5 w-5 border-b-2 border-white"></div>
            ) : (
              <Send className="w-5 h-5" />
            )}
          </button>
        </div>

        {/* Yorum ipuÃ§larÄ± */}
        <div className="mt-3 text-xs text-gray-500">
          â€¢ Enter ile gÃ¶nder, Shift+Enter ile yeni satÄ±r<br />
          â€¢ @kullanÄ±cÄ± ile etiketleyebilirsin<br />
          â€¢ Nazik ve yardÄ±msever olalÄ±m
        </div>
      </div>

      {/* Kapatma butonu (mobile iÃ§in) */}
      {onClose && (
        <div className="px-6 py-3 border-t border-gray-100 text-center">
          <button
            onClick={onClose}
            className="text-blue-600 hover:text-blue-800 text-sm font-medium"
          >
            YorumlarÄ± Kapat
          </button>
        </div>
      )}
    </div>
  )
}



// components/social/CreatePostButton.tsx
'use client'

import { useState } from 'react'
import CreatePostModal from './CreatePostModal'

export default function CreatePostButton({ variant = 'default' }: { variant?: 'default' | 'primary' }) {
  const [showModal, setShowModal] = useState(false)

  if (variant === 'primary') {
    return (
      <>
        <button
          onClick={() => setShowModal(true)}
          className="w-full bg-gradient-to-r from-blue-500 to-purple-600 text-white font-bold py-3 px-6 rounded-lg hover:from-blue-600 hover:to-purple-700 transition"
        >
          ğŸ“ Yeni PaylaÅŸÄ±m
        </button>
        
        <CreatePostModal
                isOpen={showModal}
                onClose={() => setShowModal(false)} onPostCreated={function (): void {
                    throw new Error('Function not implemented.')
                } }        />
      </>
    )
  }

  return (
    <>
      <button
        onClick={() => setShowModal(true)}
        className="fixed bottom-6 right-6 z-40 bg-gradient-to-r from-blue-500 to-purple-600 text-white p-4 rounded-full shadow-2xl hover:shadow-3xl transition-all hover:scale-110"
      >
        <div className="flex items-center space-x-2">
          <span className="text-2xl">âœï¸</span>
          <span className="font-bold hidden md:inline">PaylaÅŸ</span>
        </div>
      </button>
      
      <CreatePostModal
              isOpen={showModal}
              onClose={() => setShowModal(false)} onPostCreated={function (): void {
                  throw new Error('Function not implemented.')
              } }      />
    </>
  )
}



// components/social/CreatePostModal.tsx
'use client'

import { useState, useRef } from 'react'
import { supabase } from '@/lib/supabase'
import ImageUpload from '../ImageUpload'
import HashtagInput from './HashtagInput'
import LocationPicker from './LocationPicker'

interface CreatePostModalProps {
  isOpen: boolean
  onClose: () => void
  onPostCreated: () => void
}

export default function CreatePostModal({ 
  isOpen, 
  onClose, 
  onPostCreated 
}: CreatePostModalProps) {
  const [step, setStep] = useState(1)
  const [loading, setLoading] = useState(false)
  const [postData, setPostData] = useState({
    type: 'sighting',
    caption: '',
    location: '',
    category: '',
    hashtags: [] as string[],
    isPublic: true,
    images: [] as File[]
  })

  const fileInputRef = useRef<HTMLInputElement>(null)

  const handleImageUpload = (files: File[]) => {
    setPostData({ ...postData, images: [...postData.images, ...files] })
  }

  const removeImage = (index: number) => {
    setPostData({
      ...postData,
      images: postData.images.filter((_, i) => i !== index)
    })
  }

  const handleHashtagAdd = (hashtag: string) => {
    if (!postData.hashtags.includes(hashtag)) {
      setPostData({
        ...postData,
        hashtags: [...postData.hashtags, hashtag]
      })
    }
  }

  const handleHashtagRemove = (hashtag: string) => {
    setPostData({
      ...postData,
      hashtags: postData.hashtags.filter(h => h !== hashtag)
    })
  }

  const handleSubmit = async () => {
    setLoading(true)
    try {
      const { data: { user } } = await supabase.auth.getUser()
      if (!user) throw new Error('KullanÄ±cÄ± giriÅŸi gerekli')

      // 1. Resimleri yÃ¼kle
      const imageUrls: string[] = []
      for (const file of postData.images) {
        const fileExt = file.name.split('.').pop()
        const fileName = `${user.id}/social/${Date.now()}-${Math.random().toString(36).substring(7)}.${fileExt}`
        
        const { error: uploadError } = await supabase.storage
          .from('spot-images')
          .upload(fileName, file)

        if (uploadError) throw uploadError

        const { data: { publicUrl } } = supabase.storage
          .from('spot-images')
          .getPublicUrl(fileName)

        imageUrls.push(publicUrl)
      }

      // 2. Post'u oluÅŸtur
      const { error: postError } = await supabase
        .from('social_posts')
        .insert({
          user_id: user.id,
          type: postData.type,
          caption: postData.caption,
          location: postData.location,
          category: postData.category,
          image_urls: imageUrls,
          hashtags: postData.hashtags.map(tag => `#${tag.replace('#', '')}`),
          is_public: postData.isPublic
        })

      if (postError) throw postError

      // 3. Puan ver (gamification)
      await supabase.rpc('add_user_points', {
        user_id: user.id,
        points_to_add: 10 + (postData.images.length * 5), // 10 puan + resim baÅŸÄ±na 5 puan
        activity_type: 'social_post'
      })

      // 4. BaÅŸarÄ±lÄ±
      alert('ğŸ‰ PaylaÅŸÄ±mÄ±nÄ±z yayÄ±nlandÄ±! Puan kazandÄ±nÄ±z.')
      onPostCreated()
      onClose()
      
      // Formu temizle
      setPostData({
        type: 'sighting',
        caption: '',
        location: '',
        category: '',
        hashtags: [],
        isPublic: true,
        images: []
      })
      setStep(1)

    } catch (error) {
      console.error('Post oluÅŸturma hatasÄ±:', error)
      alert('Bir hata oluÅŸtu. LÃ¼tfen tekrar deneyin.')
    } finally {
      setLoading(false)
    }
  }

  if (!isOpen) return null

  return (
    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
      <div className="bg-white rounded-2xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-hidden">
        {/* Header */}
        <div className="border-b p-6">
          <div className="flex items-center justify-between">
            <h2 className="text-2xl font-bold text-gray-900">Yeni PaylaÅŸÄ±m</h2>
            <button
              onClick={onClose}
              className="text-gray-500 hover:text-gray-700 text-2xl"
            >
              Ã—
            </button>
          </div>
          
          {/* Step indicator */}
          <div className="flex mt-4">
            {[1, 2, 3].map((stepNum) => (
              <div key={stepNum} className="flex-1">
                <div className={`h-1 rounded-full ${
                  step >= stepNum ? 'bg-blue-600' : 'bg-gray-200'
                }`}></div>
                <p className="text-xs text-center mt-2">
                  {stepNum === 1 ? 'Medya' : stepNum === 2 ? 'Detaylar' : 'PaylaÅŸ'}
                </p>
              </div>
            ))}
          </div>
        </div>

        {/* Content */}
        <div className="p-6 overflow-y-auto max-h-[60vh]">
          {step === 1 && (
            <div>
              <h3 className="text-lg font-bold mb-4">Medya Ekle</h3>
              
              {/* Image upload area */}
              <div 
                className="border-2 border-dashed border-gray-300 rounded-2xl p-8 text-center cursor-pointer hover:border-blue-400 transition"
                onClick={() => fileInputRef.current?.click()}
              >
                {postData.images.length === 0 ? (
                  <>
                    <div className="text-4xl mb-4">ğŸ“¸</div>
                    <p className="font-medium text-gray-700">FotoÄŸraf veya video yÃ¼kleyin</p>
                    <p className="text-sm text-gray-500 mt-2">
                      SÃ¼rÃ¼kle bÄ±rak veya tÄ±kla
                    </p>
                  </>
                ) : (
                  <div className="grid grid-cols-3 gap-4">
                    {postData.images.map((image, index) => (
                      <div key={index} className="relative">
                        <img
                          src={URL.createObjectURL(image)}
                          alt={`Preview ${index}`}
                          className="w-full h-32 object-cover rounded-lg"
                        />
                        <button
                          onClick={(e) => {
                            e.stopPropagation()
                            removeImage(index)
                          }}
                          className="absolute -top-2 -right-2 bg-red-500 text-white w-6 h-6 rounded-full"
                        >
                          Ã—
                        </button>
                      </div>
                    ))}
                    <div 
                      className="border-2 border-dashed border-gray-300 rounded-lg h-32 flex items-center justify-center"
                      onClick={() => fileInputRef.current?.click()}
                    >
                      <span className="text-2xl">+</span>
                    </div>
                  </div>
                )}
              </div>

              <input
                type="file"
                ref={fileInputRef}
                multiple
                accept="image/*,video/*"
                onChange={(e) => {
                  if (e.target.files) {
                    handleImageUpload(Array.from(e.target.files))
                  }
                }}
                className="hidden"
              />

              <div className="mt-6">
                <h4 className="font-medium mb-3">PaylaÅŸÄ±m TÃ¼rÃ¼</h4>
                <div className="grid grid-cols-2 md:grid-cols-4 gap-3">
                  {[
                    { value: 'sighting', label: 'ğŸ‘ï¸ GÃ¶rdÃ¼m', desc: 'Nadir Ã¼rÃ¼n gÃ¶rdÃ¼m' },
                    { value: 'collection', label: 'ğŸ† Koleksiyon', desc: 'Koleksiyonumu paylaÅŸÄ±yorum' },
                    { value: 'question', label: 'â“ Soru', desc: 'Bu nedir?' },
                    { value: 'showcase', label: 'âœ¨ Vitrin', desc: 'ÃœrÃ¼nÃ¼mÃ¼ sergiliyorum' }
                  ].map((type) => (
                    <button
                      key={type.value}
                      onClick={() => setPostData({...postData, type: type.value})}
                      className={`p-4 rounded-xl border-2 text-center ${
                        postData.type === type.value
                          ? 'border-blue-500 bg-blue-50'
                          : 'border-gray-200 hover:border-gray-300'
                      }`}
                    >
                      <div className="text-2xl mb-2">{type.label.split(' ')[0]}</div>
                      <div className="font-medium">{type.label.split(' ')[1]}</div>
                      <div className="text-xs text-gray-500 mt-1">{type.desc}</div>
                    </button>
                  ))}
                </div>
              </div>
            </div>
          )}

          {step === 2 && (
            <div>
              <h3 className="text-lg font-bold mb-4">DetaylarÄ± Ekle</h3>
              
              {/* Caption */}
              <div className="mb-6">
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  AÃ§Ä±klama
                </label>
                <textarea
                  value={postData.caption}
                  onChange={(e) => setPostData({...postData, caption: e.target.value})}
                  placeholder="PaylaÅŸÄ±mÄ±nÄ±zÄ± anlatÄ±n..."
                  className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 h-32"
                  maxLength={2000}
                />
                <div className="text-right text-sm text-gray-500 mt-1">
                  {postData.caption.length}/2000
                </div>
              </div>

              {/* Hashtags */}
              <div className="mb-6">
                <HashtagInput
                  hashtags={postData.hashtags}
                  onAdd={handleHashtagAdd}
                  onRemove={handleHashtagRemove}
                />
              </div>

              {/* Location */}
              <div className="mb-6">
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  Konum (opsiyonel)
                </label>
                <LocationPicker
                  value={postData.location}
                  onChange={(location) => setPostData({...postData, location})}
                />
              </div>

              {/* Category */}
              <div className="mb-6">
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  Kategori
                </label>
                <select
                  value={postData.category}
                  onChange={(e) => setPostData({...postData, category: e.target.value})}
                  className="w-full px-4 py-3 border border-gray-300 rounded-lg"
                >
                  <option value="">Kategori seÃ§in</option>
                  <option value="electronics">Elektronik</option>
                  <option value="fashion">Giyim & Aksesuar</option>
                  <option value="home">Ev & BahÃ§e</option>
                  <option value="collectible">Koleksiyon</option>
                  <option value="vehicle">AraÃ§ & ParÃ§a</option>
                  <option value="other">DiÄŸer</option>
                </select>
              </div>

              {/* Privacy */}
              <div className="flex items-center space-x-3">
                <input
                  type="checkbox"
                  checked={postData.isPublic}
                  onChange={(e) => setPostData({...postData, isPublic: e.target.checked})}
                  className="w-4 h-4 text-blue-600"
                  id="isPublic"
                />
                <label htmlFor="isPublic" className="text-sm font-medium text-gray-700">
                  Herkese aÃ§Ä±k paylaÅŸ
                </label>
                <span className="text-xs text-gray-500">
                  (KapalÄ±ysa sadece takipÃ§ilerin gÃ¶rebilir)
                </span>
              </div>
            </div>
          )}

          {step === 3 && (
            <div>
              <h3 className="text-lg font-bold mb-4">Ã–nizleme</h3>
              
              {/* Post preview */}
              <div className="bg-gray-50 rounded-xl p-4">
                {/* Header preview */}
                <div className="flex items-center space-x-3 mb-4">
                  <div className="w-12 h-12 bg-gradient-to-br from-blue-400 to-purple-500 rounded-full"></div>
                  <div>
                    <div className="font-bold">Sen</div>
                    <div className="text-sm text-gray-500">
                      {postData.location || 'Konum belirtilmemiÅŸ'}
                    </div>
                  </div>
                </div>

                {/* Caption preview */}
                {postData.caption && (
                  <p className="text-gray-800 mb-4 whitespace-pre-line">
                    {postData.caption}
                    {postData.hashtags.length > 0 && (
                      <div className="mt-2">
                        {postData.hashtags.map(tag => (
                          <span key={tag} className="text-blue-600 mr-2">
                            #{tag}
                          </span>
                        ))}
                      </div>
                    )}
                  </p>
                )}

                {/* Images preview */}
                {postData.images.length > 0 && (
                  <div className="grid grid-cols-2 gap-2 mb-4">
                    {postData.images.slice(0, 4).map((image, index) => (
                      <div key={index} className="relative h-32 bg-gray-200 rounded-lg overflow-hidden">
                        <img
                          src={URL.createObjectURL(image)}
                          alt={`Preview ${index}`}
                          className="w-full h-full object-cover"
                        />
                        {postData.images.length > 4 && index === 3 && (
                          <div className="absolute inset-0 bg-black bg-opacity-60 flex items-center justify-center text-white font-bold text-lg">
                            +{postData.images.length - 4}
                          </div>
                        )}
                      </div>
                    ))}
                  </div>
                )}

                {/* Stats preview */}
                <div className="text-sm text-gray-500">
                  {postData.type === 'sighting' && 'ğŸ‘ï¸ GÃ¶rdÃ¼m paylaÅŸÄ±mÄ± â€¢ '}
                  {postData.type === 'collection' && 'ğŸ† Koleksiyon paylaÅŸÄ±mÄ± â€¢ '}
                  {postData.images.length} fotoÄŸraf â€¢ Herkese aÃ§Ä±k
                </div>
              </div>

              {/* Bonus points info */}
              <div className="mt-6 bg-gradient-to-r from-green-50 to-emerald-50 p-4 rounded-lg">
                <div className="flex items-center justify-between">
                  <div>
                    <p className="font-medium text-green-800">ğŸ‰ Puan KazanacaksÄ±nÄ±z!</p>
                    <p className="text-sm text-green-600">
                      â€¢ PaylaÅŸÄ±m: <strong>10 puan</strong><br />
                      â€¢ FotoÄŸraf baÅŸÄ±na: <strong>+5 puan</strong><br />
                      â€¢ Hashtag baÅŸÄ±na: <strong>+2 puan</strong>
                    </p>
                  </div>
                  <div className="text-2xl">ğŸ†</div>
                </div>
              </div>
            </div>
          )}
        </div>

        {/* Footer */}
        <div className="border-t p-6">
          <div className="flex justify-between">
            <button
              onClick={() => step > 1 ? setStep(step - 1) : onClose()}
              className="px-6 py-3 text-gray-700 hover:text-gray-900 font-medium"
            >
              {step === 1 ? 'Ä°ptal' : 'Geri'}
            </button>
            
            <button
              onClick={() => {
                if (step < 3) {
                  setStep(step + 1)
                } else {
                  handleSubmit()
                }
              }}
              disabled={loading || (step === 1 && postData.images.length === 0)}
              className="bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white font-bold py-3 px-8 rounded-lg disabled:opacity-50"
            >
              {loading ? (
                <span className="flex items-center">
                  <div className="animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2"></div>
                  PaylaÅŸÄ±lÄ±yor...
                </span>
              ) : step === 3 ? (
                `PaylaÅŸ (${10 + (postData.images.length * 5)} puan kazan)`
              ) : (
                'Devam Et'
              )}
            </button>
          </div>
        </div>
      </div>
    </div>
  )
}



// components/social/Feed.tsx - DÃœZELTÄ°LMÄ°Å
'use client'

import { useState, useEffect, useCallback } from 'react'
import { supabase } from '@/lib/supabase'
import FeedPost from './FeedPost'
import FeedFilters, { FilterType } from './FeedFilters' // TÄ°P IMPORT
import CreatePostButton from './CreatePostButton'
import StoriesBar from './StoriesBar'
import { useInView } from 'react-intersection-observer'

interface FeedProps {
  initialUserId?: string
  type?: FilterType // TÄ°P DÃœZELTMESÄ°
}

export default function Feed({ initialUserId, type = 'for-you' }: FeedProps) {
  const [posts, setPosts] = useState<any[]>([])
  const [loading, setLoading] = useState(true)
  const [hasMore, setHasMore] = useState(true)
  const [page, setPage] = useState(0)
  const [activeFilter, setActiveFilter] = useState<FilterType>(type) // TÄ°P DÃœZELTMESÄ°
  
  const { ref, inView } = useInView()
  const PAGE_SIZE = 10

  const fetchPosts = useCallback(async (pageNum: number, refresh = false) => {
    try {
      setLoading(true)
      
      let query = supabase
        .from('social_posts')
        .select(`
          *,
          user:user_profiles(*),
          shop:shops(*),
          likes:social_likes(count),
          comments:social_comments(count),
          saves:social_saves(count)
        `)
        .eq('status', 'active')
        .eq('is_public', true)
        .order('created_at', { ascending: false })

      // Filtreler
      switch (activeFilter) {
        case 'following':
          if (initialUserId) {
            const { data: following } = await supabase
              .from('social_follows')
              .select('following_id')
              .eq('follower_id', initialUserId)

            if (following && following.length > 0) {
              const followingIds = following.map(f => f.following_id)
              query = query.in('user_id', followingIds)
            } else {
              setPosts([])
              setHasMore(false)
              return
            }
          }
          break
        
        case 'popular':
          query = query.order('like_count', { ascending: false })
          break
        
        case 'category':
          // Kategori filtresi
          break
      }

      // Sayfalama
      const from = pageNum * PAGE_SIZE
      const to = from + PAGE_SIZE - 1
      
      query = query.range(from, to)

      const { data, error } = await query

      if (error) throw error

      if (data) {
        if (refresh) {
          setPosts(data)
        } else {
          setPosts(prev => [...prev, ...data])
        }
        
        setHasMore(data.length === PAGE_SIZE)
      }
    } catch (error) {
      console.error('Feed yÃ¼klenemedi:', error)
    } finally {
      setLoading(false)
    }
  }, [activeFilter, initialUserId])

  // Infinite scroll
  useEffect(() => {
    if (inView && hasMore && !loading) {
      const nextPage = page + 1
      setPage(nextPage)
      fetchPosts(nextPage)
    }
  }, [inView, hasMore, loading, fetchPosts, page])

  // Filtre deÄŸiÅŸince yenile
  useEffect(() => {
    setPage(0)
    setPosts([])
    fetchPosts(0, true)
  }, [activeFilter, fetchPosts])

  // Ä°lk yÃ¼kleme
  useEffect(() => {
    fetchPosts(0, true)
  }, [])

  // TÄ°P DÃœZELTMESÄ° - Promise<void> yerine void
  const handleLike = async (postId: string, liked: boolean): Promise<void> => {
    try {
      const { data: { user } } = await supabase.auth.getUser()
      if (!user) return

      if (liked) {
        await supabase
          .from('social_likes')
          .delete()
          .eq('post_id', postId)
          .eq('user_id', user.id)
      } else {
        await supabase
          .from('social_likes')
          .insert({
            post_id: postId,
            user_id: user.id
          })

        // Bildirim gÃ¶nder
        const post = posts.find(p => p.id === postId)
        if (post && post.user_id !== user.id) {
          await supabase.from('social_notifications').insert({
            user_id: post.user_id,
            type: 'like',
            actor_id: user.id,
            post_id: postId,
            message: 'paylaÅŸÄ±mÄ±nÄ± beÄŸendi'
          })
        }
      }

      // UI gÃ¼ncelle
      setPosts(prev => prev.map(post => {
        if (post.id === postId) {
          return {
            ...post,
            like_count: liked ? post.like_count - 1 : post.like_count + 1,
            is_liked: !liked
          }
        }
        return post
      }))

    } catch (error) {
      console.error('Like hatasÄ±:', error)
    }
  }

  // TÄ°P DÃœZELTMESÄ° - Promise<void> yerine void
  const handleSave = async (postId: string, saved: boolean): Promise<void> => {
    try {
      const { data: { user } } = await supabase.auth.getUser()
      if (!user) return

      if (saved) {
        await supabase
          .from('social_saves')
          .delete()
          .eq('post_id', postId)
          .eq('user_id', user.id)
      } else {
        await supabase
          .from('social_saves')
          .insert({
            post_id: postId,
            user_id: user.id
          })
      }

      // UI gÃ¼ncelle
      setPosts(prev => prev.map(post => {
        if (post.id === postId) {
          return {
            ...post,
            save_count: saved ? post.save_count - 1 : post.save_count + 1,
            is_saved: !saved
          }
        }
        return post
      }))

    } catch (error) {
      console.error('Save hatasÄ±:', error)
    }
  }

  return (
    <div className="max-w-2xl mx-auto">
      {/* Stories Bar */}
      <StoriesBar />

      {/* Create Post Button */}
      <CreatePostButton />

      {/* Filters - TÄ°P DÃœZELTMESÄ° */}
      <FeedFilters 
        activeFilter={activeFilter}
        onFilterChange={setActiveFilter}
      />

      {/* Feed Posts */}
      <div className="space-y-6 mt-6">
        {posts.map((post) => (
          <FeedPost
            key={post.id}
            post={post}
            onLike={handleLike} // TÄ°P EÅLEÅTÄ°
            onSave={handleSave} // TÄ°P EÅLEÅTÄ°
            onComment={() => console.log('comment')}
            onShare={() => console.log('share')}
          />
        ))}
      </div>

      {/* Loading & Infinite Scroll */}
      {loading && (
        <div className="mt-8 space-y-6">
          {[...Array(3)].map((_, i) => (
            <div key={i} className="animate-pulse bg-white rounded-xl shadow p-6">
              <div className="flex items-center space-x-3">
                <div className="w-12 h-12 bg-gray-200 rounded-full"></div>
                <div className="flex-1">
                  <div className="h-4 bg-gray-200 rounded w-1/4"></div>
                  <div className="h-3 bg-gray-200 rounded w-1/2 mt-2"></div>
                </div>
              </div>
              <div className="mt-4">
                <div className="h-4 bg-gray-200 rounded w-full"></div>
                <div className="h-4 bg-gray-200 rounded w-3/4 mt-2"></div>
              </div>
              <div className="mt-4 h-64 bg-gray-200 rounded-lg"></div>
            </div>
          ))}
        </div>
      )}

      {/* Infinite Scroll Trigger */}
      {hasMore && !loading && (
        <div ref={ref} className="py-8 text-center">
          <div className="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
        </div>
      )}

      {/* No Posts */}
      {!loading && posts.length === 0 && (
        <div className="text-center py-12">
          <div className="text-4xl mb-4">ğŸ“­</div>
          <h3 className="text-xl font-bold text-gray-900 mb-2">HenÃ¼z paylaÅŸÄ±m yok</h3>
          <p className="text-gray-600 mb-6">
            {activeFilter === 'following' 
              ? 'Takip ettiÄŸin kiÅŸiler henÃ¼z paylaÅŸÄ±m yapmamÄ±ÅŸ'
              : 'Ä°lk paylaÅŸÄ±mÄ± sen yap!'}
          </p>
          <CreatePostButton variant="primary" />
        </div>
      )}
    </div>
  )
}



// components/social/FeedFilters.tsx - DÃœZELTÄ°LMÄ°Å
'use client'

export type FilterType = 'for-you' | 'following' | 'popular' | 'category'

interface FeedFiltersProps {
  activeFilter: FilterType
  onFilterChange: (filter: FilterType) => void // TÄ°P DÃœZELTMESÄ°
}

export default function FeedFilters({ 
  activeFilter, 
  onFilterChange 
}: FeedFiltersProps) {
  const filters: Array<{ id: FilterType; label: string; icon: string }> = [
    { id: 'for-you', label: 'Sana Ã–zel', icon: 'ğŸ¯' },
    { id: 'following', label: 'Takip Edilenler', icon: 'ğŸ‘¥' },
    { id: 'popular', label: 'PopÃ¼ler', icon: 'ğŸ”¥' },
    { id: 'category', label: 'Kategoriler', icon: 'ğŸ·ï¸' }
  ]

  return (
    <div className="flex overflow-x-auto space-x-2 pb-4">
      {filters.map((filter) => (
        <button
          key={filter.id}
          onClick={() => onFilterChange(filter.id)}
          className={`flex items-center space-x-2 px-4 py-2 rounded-full whitespace-nowrap transition ${
            activeFilter === filter.id
              ? 'bg-blue-600 text-white'
              : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
          }`}
        >
          <span>{filter.icon}</span>
          <span>{filter.label}</span>
        </button>
      ))}
    </div>
  )
}



// components/social/FeedPost.tsx - DÃœZELTÄ°LMÄ°Å
'use client'

import { useState, useEffect } from 'react'
import { supabase } from '@/lib/supabase'
import Image from 'next/image'
import Link from 'next/link'
import PostActions from './PostActions'
import CommentsSection from './CommentsSection' // âœ… DÃœZELTÄ°LDÄ°
import PostHeader from './PostHeader' // âœ… DÃœZELTÄ°LDÄ°

interface FeedPostProps {
  post: any
  onLike: (postId: string, liked: boolean) => void
  onSave: (postId: string, saved: boolean) => void
  onComment: () => void
  onShare: () => void
  showFull?: boolean
}

export default function FeedPost({ 
  post, 
  onLike, 
  onSave, 
  onComment, 
  onShare,
  showFull = false 
}: FeedPostProps) {
  const [isLiked, setIsLiked] = useState(false)
  const [isSaved, setIsSaved] = useState(false)
  const [showComments, setShowComments] = useState(false)
  const [imageIndex, setImageIndex] = useState(0)
  const [user, setUser] = useState<any>(null)

  useEffect(() => {
    checkUserInteractions()
    fetchUser()
  }, [post.id])

  const checkUserInteractions = async () => {
    try {
      const { data: { user: authUser } } = await supabase.auth.getUser()
      if (!authUser) return

      // BeÄŸeni kontrolÃ¼
      const { data: like } = await supabase
        .from('social_likes')
        .select('id')
        .eq('post_id', post.id)
        .eq('user_id', authUser.id)
        .single()

      // Kaydetme kontrolÃ¼
      const { data: save } = await supabase
        .from('social_saves')
        .select('id')
        .eq('post_id', post.id)
        .eq('user_id', authUser.id)
        .single()

      setIsLiked(!!like)
      setIsSaved(!!save)
    } catch (error) {
      // Hata durumunda silent fail
    }
  }

  const fetchUser = async () => {
    if (!post.user_id) return
    const { data } = await supabase
      .from('user_profiles')
      .select('*')
      .eq('id', post.user_id)
      .single()
    setUser(data)
  }

  // TÄ°P DÃœZELTMESÄ° - async/await eklendi
  const handleLikeClick = async () => {
    const newLikedState = !isLiked
    setIsLiked(newLikedState)
    await onLike(post.id, isLiked)
  }

  // TÄ°P DÃœZELTMESÄ° - async/await eklendi
  const handleSaveClick = async () => {
    const newSavedState = !isSaved
    setIsSaved(newSavedState)
    await onSave(post.id, isSaved)
  }

  const hasMultipleImages = post.image_urls && post.image_urls.length > 1

  return (
    <div className="bg-white rounded-xl shadow-lg overflow-hidden">
      {/* Header - KullanÄ±cÄ± bilgileri */}
      <PostHeader 
        user={user || post.user}
        post={post}
        onFollow={() => console.log('follow')}
      />

      {/* Caption */}
      {post.caption && (
        <div className="px-6 pt-4">
          <p className="text-gray-800 whitespace-pre-line">
            {post.caption}
            
            {/* Hashtag'ler */}
            {post.hashtags && post.hashtags.length > 0 && (
              <div className="mt-2">
                {post.hashtags.map((tag: string) => (
                  <Link
                    key={tag}
                    href={`/discover/tags/${tag.replace('#', '')}`}
                    className="inline-block text-blue-600 hover:text-blue-800 mr-2 text-sm"
                  >
                    {tag}
                  </Link>
                ))}
              </div>
            )}
          </p>
          
          {/* Konum */}
          {post.location && (
            <div className="mt-2 flex items-center text-gray-600 text-sm">
              <span className="mr-1">ğŸ“</span>
              {post.location}
            </div>
          )}
        </div>
      )}

      {/* Medya - Image/Video */}
      {post.image_urls && post.image_urls.length > 0 && (
        <div className="relative mt-4">
          {/* Ana resim */}
          <div className="relative h-[500px] bg-gray-100">
            <img
              src={post.image_urls[imageIndex]}
              alt={post.caption || 'Post image'}
              className="w-full h-full object-contain"
            />

            {/* Ã‡oklu resim navigasyonu */}
            {hasMultipleImages && (
              <>
                {/* Dots indicator */}
                <div className="absolute bottom-4 left-1/2 transform -translate-x-1/2 flex space-x-2">
                  {post.image_urls.map((_: any, index: number) => (
                    <button
                      key={index}
                      onClick={() => setImageIndex(index)}
                      className={`w-2 h-2 rounded-full ${
                        index === imageIndex ? 'bg-white' : 'bg-white bg-opacity-50'
                      }`}
                    />
                  ))}
                </div>

                {/* Navigation buttons */}
                {imageIndex > 0 && (
                  <button
                    onClick={() => setImageIndex(prev => prev - 1)}
                    className="absolute left-4 top-1/2 transform -translate-y-1/2 w-10 h-10 bg-white bg-opacity-80 rounded-full flex items-center justify-center hover:bg-opacity-100"
                  >
                    â†
                  </button>
                )}
                {imageIndex < post.image_urls.length - 1 && (
                  <button
                    onClick={() => setImageIndex(prev => prev + 1)}
                    className="absolute right-4 top-1/2 transform -translate-y-1/2 w-10 h-10 bg-white bg-opacity-80 rounded-full flex items-center justify-center hover:bg-opacity-100"
                  >
                    â†’
                  </button>
                )}
              </>
            )}
          </div>

          {/* Image counter */}
          {hasMultipleImages && (
            <div className="absolute top-4 right-4 bg-black bg-opacity-60 text-white px-3 py-1 rounded-full text-sm">
              {imageIndex + 1} / {post.image_urls.length}
            </div>
          )}
        </div>
      )}

      {/* Ä°statistikler */}
      <div className="px-6 py-3 border-t border-gray-100">
        <div className="flex items-center justify-between text-sm text-gray-600">
          <div className="flex items-center space-x-4">
            <div className="flex items-center">
              <span className="mr-1">â¤ï¸</span>
              <span className="font-medium">{post.like_count || 0}</span>
            </div>
            <div className="flex items-center">
              <span className="mr-1">ğŸ’¬</span>
              <span className="font-medium">{post.comment_count || 0}</span>
            </div>
            <div className="flex items-center">
              <span className="mr-1">ğŸ“¤</span>
              <span className="font-medium">{post.share_count || 0}</span>
            </div>
          </div>
          <div className="flex items-center">
            <span className="mr-1">ğŸ‘ï¸</span>
            <span className="font-medium">{post.view_count || 0}</span>
          </div>
        </div>
      </div>

      {/* Aksiyon ButonlarÄ± */}
      <PostActions
        isLiked={isLiked}
        isSaved={isSaved}
        onLike={handleLikeClick} // async fonksiyon
        onSave={handleSaveClick} // async fonksiyon
        onComment={() => {
          setShowComments(!showComments)
          onComment()
        }}
        onShare={onShare}
      />

      {/* Yorumlar BÃ¶lÃ¼mÃ¼ */}
      {showComments && (
        <CommentsSection 
          postId={post.id}
          initialComments={post.comments || []}
          onClose={() => setShowComments(false)}
        />
      )}

      {/* Zamansal bilgi */}
      <div className="px-6 py-3 border-t border-gray-100">
        <p className="text-xs text-gray-500">
          {new Date(post.created_at).toLocaleDateString('tr-TR', {
            hour: '2-digit',
            minute: '2-digit'
          })}
        </p>
      </div>
    </div>
  )
}



// components/social/HashtagInput.tsx
'use client'

import { useState } from 'react'

interface HashtagInputProps {
  hashtags: string[]
  onAdd: (hashtag: string) => void
  onRemove: (hashtag: string) => void
}

export default function HashtagInput({ hashtags, onAdd, onRemove }: HashtagInputProps) {
  const [input, setInput] = useState('')

  const handleAdd = () => {
    const cleanTag = input.trim().replace(/#/g, '')
    if (cleanTag && !hashtags.includes(cleanTag)) {
      onAdd(cleanTag)
      setInput('')
    }
  }

  const handleKeyDown = (e: React.KeyboardEvent) => {
    if (e.key === 'Enter' || e.key === ',') {
      e.preventDefault()
      handleAdd()
    }
  }

  return (
    <div className="space-y-3">
      <label className="block text-sm font-medium text-gray-700">
        Hashtag'ler (opsiyonel)
      </label>
      
      <div className="flex">
        <input
          type="text"
          value={input}
          onChange={(e) => setInput(e.target.value)}
          onKeyDown={handleKeyDown}
          placeholder="#vintage #kamera #antika"
          className="flex-1 px-4 py-2 border border-gray-300 rounded-l-lg"
        />
        <button
          type="button"
          onClick={handleAdd}
          className="px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-r-lg"
        >
          Ekle
        </button>
      </div>

      {/* Hashtag listesi */}
      <div className="flex flex-wrap gap-2">
        {hashtags.map((tag) => (
          <div
            key={tag}
            className="flex items-center bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm"
          >
            #{tag}
            <button
              type="button"
              onClick={() => onRemove(tag)}
              className="ml-2 text-blue-600 hover:text-blue-900"
            >
              Ã—
            </button>
          </div>
        ))}
      </div>

      <p className="text-xs text-gray-500">
        Hashtag baÅŸÄ±na +2 puan kazanÄ±rsÄ±nÄ±z. Max 5 hashtag.
      </p>
    </div>
  )
}



// components/social/LocationPicker.tsx
'use client'

import { useState } from 'react'
import { MapPin } from 'lucide-react'

interface LocationPickerProps {
  value: string
  onChange: (value: string) => void
}

export default function LocationPicker({ value, onChange }: LocationPickerProps) {
  const popularLocations = [
    'Ä°stanbul', 'Ankara', 'Ä°zmir', 'Bursa', 'Antalya',
    'Evim', 'Ä°ÅŸyeri', 'Sahil', 'AlÄ±ÅŸveriÅŸ Merkezi'
  ]

  return (
    <div className="space-y-3">
      <div className="relative">
        <MapPin className="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5" />
        <input
          type="text"
          value={value}
          onChange={(e) => onChange(e.target.value)}
          placeholder="Nerede Ã§ektiniz? (opsiyonel)"
          className="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg"
        />
      </div>

      <div className="flex flex-wrap gap-2">
        {popularLocations.map((location) => (
          <button
            key={location}
            type="button"
            onClick={() => onChange(location)}
            className="px-3 py-1.5 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-full text-sm"
          >
            {location}
          </button>
        ))}
      </div>
    </div>
  )
}



// components/social/MobileNavigation.tsx
'use client'

import { useState } from 'react'
import { usePathname } from 'next/navigation'
import Link from 'next/link'

export default function MobileNavigation() {
  const pathname = usePathname()
  const [showMenu, setShowMenu] = useState(false)

  const navItems = [
    { path: '/discovery', label: 'KeÅŸfet', icon: 'ğŸ”' },
    { path: '/discovery?tab=following', label: 'Takip', icon: 'ğŸ‘¥' },
    { path: '/discovery/create', label: 'OluÅŸtur', icon: 'â•', highlight: true },
    { path: '/discovery/notifications', label: 'Bildirim', icon: 'ğŸ””' },
    { path: '/discovery/profile', label: 'Profil', icon: 'ğŸ‘¤' },
  ]

  return (
    <>
      {/* Mobile Bottom Nav */}
      <div className="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 z-40 md:hidden">
        <div className="flex justify-around items-center h-16">
          {navItems.map((item) => {
            const isActive = pathname === item.path
            
            return (
              <Link
                key={item.path}
                href={item.path}
                className={`flex flex-col items-center justify-center ${
                  isActive ? 'text-blue-600' : 'text-gray-600'
                }`}
              >
                <div className={`text-2xl ${item.highlight ? 'text-blue-600' : ''}`}>
                  {item.icon}
                </div>
                <span className="text-xs mt-1">{item.label}</span>
              </Link>
            )
          })}
        </div>
      </div>

      {/* Mobile iÃ§in ekstra padding */}
      <div className="pb-16 md:pb-0"></div>
    </>
  )
}



// components/social/PostActions.tsx - DÃœZELTÄ°LMÄ°Å
'use client'

import { useState } from 'react'

interface PostActionsProps {
  isLiked: boolean
  isSaved: boolean
  onLike: () => void | Promise<void> // TÄ°P DÃœZELTMESÄ°
  onSave: () => void | Promise<void> // TÄ°P DÃœZELTMESÄ°
  onComment: () => void
  onShare: () => void
}

export default function PostActions({
  isLiked,
  isSaved,
  onLike,
  onSave,
  onComment,
  onShare
}: PostActionsProps) {
  const [showReactions, setShowReactions] = useState(false)
  const [showShareMenu, setShowShareMenu] = useState(false)

  const reactions = [
    { emoji: 'â¤ï¸', label: 'Like', value: 'like' },
    { emoji: 'ğŸ˜', label: 'Love', value: 'love' },
    { emoji: 'ğŸ˜®', label: 'Wow', value: 'wow' },
    { emoji: 'ğŸ˜‚', label: 'Haha', value: 'laugh' },
    { emoji: 'ğŸ˜¢', label: 'Sad', value: 'sad' },
    { emoji: 'ğŸ˜ ', label: 'Angry', value: 'angry' }
  ]

  const shareOptions = [
    { icon: 'ğŸ“±', label: 'Mesaj', action: 'message' },
    { icon: 'ğŸ“§', label: 'Email', action: 'email' },
    { icon: 'ğŸ”—', label: 'Kopyala', action: 'copy' },
    { icon: 'ğŸ“˜', label: 'Facebook', action: 'facebook' },
    { icon: 'ğŸ¦', label: 'Twitter', action: 'twitter' }
  ]

  const handleReaction = (reaction: string) => {
    console.log('Reaction:', reaction)
    setShowReactions(false)
  }

  const handleShare = (action: string) => {
    console.log('Share action:', action)
    setShowShareMenu(false)
  }

  return (
    <div className="px-6 py-3 border-t border-gray-100">
      <div className="flex items-center justify-between">
        {/* Sol taraf - BeÄŸeni ve yorum */}
        <div className="flex items-center space-x-4">
          {/* BeÄŸeni butonu ve reactions */}
          <div className="relative">
            <button
              onClick={onLike}
              onMouseEnter={() => setShowReactions(true)}
              onMouseLeave={() => setTimeout(() => setShowReactions(false), 500)}
              className={`flex items-center space-x-2 px-3 py-2 rounded-lg transition ${
                isLiked 
                  ? 'bg-red-50 text-red-600' 
                  : 'hover:bg-gray-100 text-gray-700'
              }`}
            >
              <span className="text-xl">{isLiked ? 'â¤ï¸' : 'ğŸ¤'}</span>
              <span className="font-medium">BeÄŸen</span>
            </button>

            {/* Reactions popup */}
            {showReactions && (
              <div 
                className="absolute bottom-full left-0 mb-2 bg-white rounded-xl shadow-2xl border p-2 flex space-x-1 z-50"
                onMouseEnter={() => setShowReactions(true)}
                onMouseLeave={() => setShowReactions(false)}
              >
                {reactions.map((reaction) => (
                  <button
                    key={reaction.value}
                    onClick={() => handleReaction(reaction.value)}
                    className="w-10 h-10 hover:scale-125 transform transition duration-200 text-2xl"
                    title={reaction.label}
                  >
                    {reaction.emoji}
                  </button>
                ))}
              </div>
            )}
          </div>

          {/* Yorum butonu */}
          <button
            onClick={onComment}
            className="flex items-center space-x-2 px-3 py-2 rounded-lg hover:bg-gray-100 text-gray-700"
          >
            <span className="text-xl">ğŸ’¬</span>
            <span className="font-medium">Yorum</span>
          </button>
        </div>

        {/* SaÄŸ taraf - PaylaÅŸ ve kaydet */}
        <div className="flex items-center space-x-2">
          {/* Kaydet butonu */}
          <button
            onClick={onSave}
            className={`p-2 rounded-full ${
              isSaved 
                ? 'bg-yellow-50 text-yellow-600' 
                : 'hover:bg-gray-100 text-gray-700'
            }`}
            title={isSaved ? 'Kaydedildi' : 'Kaydet'}
          >
            <span className="text-xl">
              {isSaved ? 'â­' : 'âœ°'}
            </span>
          </button>

          {/* PaylaÅŸ butonu ve menu */}
          <div className="relative">
            <button
              onClick={() => setShowShareMenu(!showShareMenu)}
              className="p-2 rounded-full hover:bg-gray-100 text-gray-700"
              title="PaylaÅŸ"
            >
              <span className="text-xl">ğŸ“¤</span>
            </button>

            {/* Share menu */}
            {showShareMenu && (
              <div className="absolute right-0 bottom-full mb-2 bg-white rounded-xl shadow-2xl border p-3 w-48 z-50">
                <div className="space-y-2">
                  {shareOptions.map((option) => (
                    <button
                      key={option.action}
                      onClick={() => handleShare(option.action)}
                      className="w-full flex items-center space-x-3 px-3 py-2 rounded-lg hover:bg-gray-100 text-gray-700"
                    >
                      <span className="text-xl">{option.icon}</span>
                      <span>{option.label}</span>
                    </button>
                  ))}
                </div>
              </div>
            )}
          </div>
        </div>
      </div>
    </div>
  )
}



// components/social/PostHeader.tsx
'use client'

import { useState } from 'react'
import { MoreVertical, MapPin, Calendar } from 'lucide-react'

interface PostHeaderProps {
  user: any
  post: any
  onFollow?: () => void
  onReport?: () => void
}

export default function PostHeader({ user, post, onFollow, onReport }: PostHeaderProps) {
  const [showMenu, setShowMenu] = useState(false)
  const [isFollowing, setIsFollowing] = useState(false)

  const handleFollow = () => {
    setIsFollowing(!isFollowing)
    if (onFollow) onFollow()
  }

  const handleReport = () => {
    setShowMenu(false)
    if (onReport) onReport()
  }

  const formatDate = (dateString: string) => {
    const date = new Date(dateString)
    const now = new Date()
    const diffMs = now.getTime() - date.getTime()
    const diffHours = Math.floor(diffMs / (1000 * 60 * 60))
    
    if (diffHours < 1) {
      return 'Az Ã¶nce'
    } else if (diffHours < 24) {
      return `${diffHours} saat Ã¶nce`
    } else {
      return date.toLocaleDateString('tr-TR')
    }
  }

  return (
    <div className="px-6 py-4">
      <div className="flex items-start justify-between">
        {/* Sol taraf - KullanÄ±cÄ± bilgileri */}
        <div className="flex items-center space-x-3">
          {/* Avatar */}
          <div className="relative">
            <div className="w-12 h-12 rounded-full overflow-hidden bg-gradient-to-br from-blue-400 to-purple-500">
              {user?.avatar_url ? (
                <img
                  src={user.avatar_url}
                  alt={user?.name || 'KullanÄ±cÄ±'}
                  className="w-full h-full object-cover"
                />
              ) : (
                <div className="w-full h-full flex items-center justify-center text-white font-bold text-lg">
                  {user?.name?.[0]?.toUpperCase() || 'K'}
                </div>
              )}
            </div>
            
            {/* Online status indicator */}
            <div className="absolute bottom-0 right-0 w-3 h-3 bg-green-500 border-2 border-white rounded-full"></div>
          </div>

          {/* KullanÄ±cÄ± bilgileri */}
          <div className="flex-1">
            <div className="flex items-center space-x-2">
              <h4 className="font-bold text-gray-900">
                {user?.name || 'KullanÄ±cÄ±'}
              </h4>
              
              {/* Verified badge (maÄŸaza veya premium kullanÄ±cÄ±) */}
              {post?.shop_id && (
                <span className="bg-blue-100 text-blue-800 text-xs px-2 py-0.5 rounded-full">
                  ğŸª MaÄŸaza
                </span>
              )}
              
              {/* Seviye badge */}
              {user?.reputation?.level && user.reputation.level > 2 && (
                <span className="bg-yellow-100 text-yellow-800 text-xs px-2 py-0.5 rounded-full">
                  â­ Lv.{user.reputation.level}
                </span>
              )}
            </div>
            
            <div className="flex items-center text-sm text-gray-500 space-x-3 mt-1">
              {post?.location && (
                <div className="flex items-center">
                  <MapPin className="w-3 h-3 mr-1" />
                  <span>{post.location}</span>
                </div>
              )}
              
              <div className="flex items-center">
                <Calendar className="w-3 h-3 mr-1" />
                <span>{formatDate(post.created_at)}</span>
              </div>
            </div>
          </div>
        </div>

        {/* SaÄŸ taraf - MenÃ¼ ve takip butonu */}
        <div className="flex items-center space-x-2">
          {/* Takip butonu */}
          <button
            onClick={handleFollow}
            className={`px-4 py-2 rounded-full text-sm font-medium ${
              isFollowing
                ? 'bg-gray-100 text-gray-700 hover:bg-gray-200'
                : 'bg-blue-600 text-white hover:bg-blue-700'
            }`}
          >
            {isFollowing ? 'Takip Ediliyor' : 'Takip Et'}
          </button>

          {/* Daha fazla menÃ¼sÃ¼ */}
          <div className="relative">
            <button
              onClick={() => setShowMenu(!showMenu)}
              className="p-2 hover:bg-gray-100 rounded-full"
            >
              <MoreVertical className="w-5 h-5 text-gray-500" />
            </button>

            {showMenu && (
              <div className="absolute right-0 top-full mt-1 bg-white rounded-lg shadow-lg border w-48 z-50">
                <button
                  onClick={() => {
                    setShowMenu(false)
                    // PaylaÅŸÄ±mÄ± kaydet
                  }}
                  className="w-full text-left px-4 py-3 hover:bg-gray-50 text-gray-700"
                >
                  ğŸ“Œ Kaydet
                </button>
                <button
                  onClick={() => {
                    setShowMenu(false)
                    // BaÄŸlantÄ±yÄ± kopyala
                  }}
                  className="w-full text-left px-4 py-3 hover:bg-gray-50 text-gray-700"
                >
                  ğŸ”— BaÄŸlantÄ±yÄ± Kopyala
                </button>
                <button
                  onClick={handleReport}
                  className="w-full text-left px-4 py-3 hover:bg-gray-50 text-red-600 border-t"
                >
                  âš ï¸ Bildir
                </button>
              </div>
            )}
          </div>
        </div>
      </div>

      {/* Post tipi indicator */}
      {post?.type && (
        <div className="mt-3">
          <span className={`inline-block px-3 py-1 rounded-full text-xs font-medium ${
            post.type === 'sighting' 
              ? 'bg-green-100 text-green-800' 
              : post.type === 'collection'
              ? 'bg-purple-100 text-purple-800'
              : 'bg-blue-100 text-blue-800'
          }`}>
            {post.type === 'sighting' && 'ğŸ‘ï¸ GÃ¶rÃ¼ldÃ¼'}
            {post.type === 'collection' && 'ğŸ† Koleksiyon'}
            {post.type === 'question' && 'â“ Soru'}
            {post.type === 'showcase' && 'âœ¨ Vitrin'}
          </span>
        </div>
      )}
    </div>
  )
}


// components/social/StoriesBar.tsx - BASÄ°T
'use client'

export default function StoriesBar() {
  const stories = [
    { id: 1, user: 'Ahmet', hasNew: true },
    { id: 2, user: 'Zeynep', hasNew: false },
    { id: 3, user: 'Mehmet', hasNew: true },
    { id: 4, user: 'AyÅŸe', hasNew: false },
    { id: 5, user: 'Can', hasNew: true },
  ]

  return (
    <div className="bg-white rounded-xl shadow p-4 mb-6">
      <div className="flex space-x-4 overflow-x-auto pb-2">
        {/* Kendi story */}
        <button className="flex-shrink-0 text-center">
          <div className="w-20 h-20 rounded-full border-4 border-blue-500 flex items-center justify-center text-2xl bg-gradient-to-br from-blue-400 to-purple-500 text-white">
            +
          </div>
          <div className="text-xs mt-2">Sen</div>
        </button>

        {/* DiÄŸer story'ler */}
        {stories.map((story) => (
          <button key={story.id} className="flex-shrink-0 text-center">
            <div className={`w-20 h-20 rounded-full ${story.hasNew ? 'border-4 border-green-500' : 'border-2 border-gray-300'}`}>
              <div className="w-full h-full rounded-full bg-gradient-to-br from-pink-400 to-orange-500"></div>
            </div>
            <div className="text-xs mt-2 truncate w-20">{story.user}</div>
          </button>
        ))}
      </div>
    </div>
  )
}


// components/social/SuggestedUsers.tsx
'use client'

import { useEffect, useState } from 'react'
import { supabase } from '@/lib/supabase'
import { useRouter } from 'next/navigation'

export default function SuggestedUsers() {
  const router = useRouter()
  const [users, setUsers] = useState<any[]>([])
  const [loading, setLoading] = useState(true)

  useEffect(() => {
    fetchSuggestedUsers()
  }, [])

  const fetchSuggestedUsers = async () => {
    try {
      // En aktif 5 kullanÄ±cÄ±
      const { data } = await supabase
        .from('user_profiles')
        .select('*')
        .limit(5)
        .order('created_at', { ascending: false })

      setUsers(data || [])
    } catch (error) {
      console.error('KullanÄ±cÄ±lar yÃ¼klenemedi:', error)
    } finally {
      setLoading(false)
    }
  }

  const handleFollow = async (userId: string) => {
    // Takip etme iÅŸlemi
    console.log('Takip ediliyor:', userId)
  }

  if (loading) {
    return (
      <div className="bg-white rounded-xl shadow p-6">
        <h3 className="font-bold text-gray-900 mb-4">ğŸ‘¥ Ã–nerilen KullanÄ±cÄ±lar</h3>
        <div className="space-y-4">
          {[...Array(3)].map((_, i) => (
            <div key={i} className="animate-pulse flex items-center space-x-3">
              <div className="w-10 h-10 bg-gray-200 rounded-full"></div>
              <div className="flex-1">
                <div className="h-4 bg-gray-200 rounded w-1/2"></div>
                <div className="h-3 bg-gray-200 rounded w-1/4 mt-2"></div>
              </div>
            </div>
          ))}
        </div>
      </div>
    )
  }

  return (
    <div className="bg-white rounded-xl shadow p-6">
      <h3 className="font-bold text-gray-900 mb-4">ğŸ‘¥ Ã–nerilen KullanÄ±cÄ±lar</h3>
      <div className="space-y-4">
        {users.map((user) => (
          <div key={user.id} className="flex items-center justify-between">
            <div className="flex items-center space-x-3">
              <div className="w-10 h-10 rounded-full bg-gradient-to-br from-blue-400 to-purple-500 flex items-center justify-center text-white font-bold">
                {user.name?.[0] || 'K'}
              </div>
              <div>
                <div className="font-medium">{user.name}</div>
                {user.bio && (
                  <div className="text-xs text-gray-500 truncate max-w-[120px]">
                    {user.bio}
                  </div>
                )}
              </div>
            </div>
            
            <button
              onClick={() => handleFollow(user.id)}
              className="px-3 py-1 bg-blue-600 hover:bg-blue-700 text-white text-sm rounded-lg"
            >
              Takip Et
            </button>
          </div>
        ))}
      </div>
      
      {users.length === 0 && (
        <p className="text-gray-500 text-center py-4">
          HenÃ¼z Ã¶nerilecek kullanÄ±cÄ± yok
        </p>
      )}
    </div>
  )
}



// components/social/TrendingHashtags.tsx
'use client'

import { useEffect, useState } from 'react'
import { supabase } from '@/lib/supabase'
import { useRouter } from 'next/navigation'

export default function TrendingHashtags() {
  const router = useRouter()
  const [hashtags, setHashtags] = useState<any[]>([])
  const [loading, setLoading] = useState(true)

  useEffect(() => {
    fetchTrendingHashtags()
  }, [])

  const fetchTrendingHashtags = async () => {
    try {
      // Bu haftanÄ±n popÃ¼ler hashtag'leri
      const { data } = await supabase
        .from('social_hashtags')
        .select('*')
        .order('post_count', { ascending: false })
        .limit(8)

      setHashtags(data || [])
    } catch (error) {
      console.error('Hashtag yÃ¼klenemedi:', error)
    } finally {
      setLoading(false)
    }
  }

  if (loading) {
    return (
      <div className="bg-white rounded-xl shadow p-6">
        <h3 className="font-bold text-gray-900 mb-4">ğŸ”¥ PopÃ¼ler Hashtag'ler</h3>
        <div className="space-y-2">
          {[...Array(5)].map((_, i) => (
            <div key={i} className="animate-pulse h-8 bg-gray-200 rounded"></div>
          ))}
        </div>
      </div>
    )
  }

  return (
    <div className="bg-white rounded-xl shadow p-6">
      <h3 className="font-bold text-gray-900 mb-4">ğŸ”¥ PopÃ¼ler Hashtag'ler</h3>
      <div className="space-y-3">
        {hashtags.map((hashtag, index) => (
          <button
            key={hashtag.name}
            onClick={() => router.push(`/discovery/tags/${hashtag.name.replace('#', '')}`)}
            className="w-full flex items-center justify-between p-2 hover:bg-gray-50 rounded-lg"
          >
            <div className="flex items-center">
              <span className="text-lg mr-3">{index < 3 ? 'ğŸ”¥' : '#'}</span>
              <div>
                <div className="font-medium text-left">{hashtag.name}</div>
                <div className="text-xs text-gray-500 text-left">
                  {hashtag.post_count} paylaÅŸÄ±m
                </div>
              </div>
            </div>
            <div className="text-blue-600 text-sm">â†’</div>
          </button>
        ))}
      </div>
      
      {hashtags.length === 0 && (
        <p className="text-gray-500 text-center py-4">
          HenÃ¼z popÃ¼ler hashtag yok
        </p>
      )}
    </div>
  )
}


